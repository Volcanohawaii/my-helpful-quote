<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Destiny Lab</title>
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; base-uri 'self'; object-src 'none'; script-src 'self' 'unsafe-inline' https://t1.daumcdn.net https://*.daumcdn.net https://display.ad.daum.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data: https://api.countapi.xyz https://countapi.mileshilliard.com https://t1.daumcdn.net https://*.daumcdn.net https://display.adfit.kakao.com https://display.ad.daum.net; frame-src https://display.adfit.kakao.com https://t1.daumcdn.net https://*.daumcdn.net https://display.ad.daum.net; connect-src 'self' https://api.countapi.xyz https://countapi.mileshilliard.com https://display.ad.daum.net https://display.adfit.kakao.com https://aem-kakao-collector.onkakao.net;">

  <style>
    * { box-sizing: border-box; }
    :root { --bg: #F0EDE9; --paper: #FFFFFF; --primary: #243447; --accent: #9A8467; --text: #444444; --border: #D1CDC5; }
    body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; overflow-x: hidden; position: relative; }
    body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; background-image: radial-gradient(circle at center, rgba(255, 255, 255, 1) 1.2px, transparent 2px), radial-gradient(circle at center, rgba(154, 132, 103, 0.9) 2px, transparent 4px); background-size: 60px 60px, 140px 140px; background-position: 0 0, 30px 30px; opacity: 1; animation: twinkle 4s ease-in-out infinite alternate; }
    @keyframes twinkle { 0% { opacity: 0.5; } 100% { opacity: 1; } }
    .container { width: 100%; max-width: 480px; position: relative; z-index: 1; }
    .lang-toggle { position: absolute; top: -50px; right: 0; display: flex; gap: 15px; }
    .flag { font-size: 1.6rem; cursor: pointer; opacity: 0.4; transition: 0.3s; }
    .flag.active { opacity: 1; transform: scale(1.2); }
    .report-card { background: var(--paper); padding: 55px 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); border: 1px solid var(--border); text-align: center; position: relative; animation: fadeIn 0.8s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    .official-seal { position: absolute; top: 25px; right: 25px; width: 65px; height: 65px; border: 2px double var(--accent); color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Gowun Batang'; font-size: 0.7rem; font-weight: 700; opacity: 0.5; transform: rotate(12deg); }
    h1 { font-family: 'Gowun Batang'; font-size: 1.4rem; color: var(--primary); margin-bottom: 10px; }
    .summary-line { font-family: 'Gowun Batang'; font-size: 0.95rem; color: var(--accent); margin-bottom: 30px; font-weight: 600; line-height: 1.4; }
    .tab-content { text-align: left; line-height: 1.8; font-size: 0.95rem; }
    .section-wrap { margin-bottom: 30px; }
    .section-title { font-family: 'Gowun Batang'; font-size: 1rem; color: var(--accent); display: block; margin-bottom: 12px; font-weight: 700; border-bottom: 1px solid #F0F0F0; }
    .info-box { background: #F9F8F6; padding: 18px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 15px; }
    .warning-box { background: #FFF5F5; padding: 15px; border-radius: 8px; font-size: 0.85rem; color: #C0392B; margin-top: 25px; }
    .tabs { display: flex; border-bottom: 1px solid #EEE; margin: 25px 0; }
    .tab-btn { flex: 1; padding: 12px 0; border: none; background: none; cursor: pointer; font-size: 0.85rem; color: #BBB; font-family: 'Gowun Batang'; }
    .tab-btn.active { color: var(--primary); font-weight: 700; border-bottom: 2px solid var(--primary); }
    .btn-action { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 1rem; }
    .hidden { display: none; }
    input { width: 100%; padding: 15px; margin-bottom: 15px; border: none; border-bottom: 1px solid #DDD; font-size: 1.1rem; outline: none; background: transparent; }
    .visitor-counter { margin-top: 25px; font-size: 0.75rem; color: #AAA; font-family: 'Gowun Batang'; border-top: 1px solid #F5F5F5; padding-top: 15px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* âœ… ë¡œë”© ì˜¤ë²„ë ˆì´: display:none ëŒ€ì‹  opacity/visibilityë¡œ ìˆ¨ê¹€(ê´‘ê³  ë¡œë”© ì•ˆì •) */
    #loading-overlay{
  position:fixed; inset:0; z-index:9999;
  background:rgba(240, 237, 233, 0.96);
  display:flex; align-items:center; justify-content:center;

  opacity:0;
  pointer-events:none;
  transition: opacity .15s ease;
}
#loading-overlay.show{
  opacity:1;
  pointer-events:auto;
}
  </style>
</head>

<body oncontextmenu="return false" onselectstart="return false">

  <!-- âœ… ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loading-overlay">
    <div style="background:white; padding:40px; border-radius:15px; text-align:center; width:100%; max-width:340px;">
      <div id="load-seal" class="official-seal" style="position:static; margin-bottom:20px;">ë¶„ì„ì¤‘</div>
      <h2 id="load-title" style="font-family:'Gowun Batang'; color:var(--primary); font-size:1.1rem;">ìš´ëª…ì˜ ì—ë„ˆì§€ë¥¼ ì¡°í•© ì¤‘...</h2>
      <p id="load-desc" style="color:#888; font-size:0.8rem; margin-bottom:20px;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
      
      <div style="margin:16px auto 10px; width:300px; height:250px; display:flex; justify-content:center;">
  <ins class="kakao_ad_area" style="display:none;width:100%;"
  data-ad-unit="DAN-pMoVBneQCSicnBZ7"
  data-ad-width="300"
  data-ad-height="250"></ins>  
</div>
      
      <div style="border:3px solid #f3f3f3; border-top:3px solid var(--accent); border-radius:50%; width:24px; height:24px; animation:spin 1s linear infinite; margin:0 auto;"></div>
    </div>
  </div>

  <div class="container">
    <div class="lang-toggle">
      <span class="flag active" id="flag-ko" onclick="setLang('ko')">ğŸ‡°ğŸ‡·</span>
      <span class="flag" id="flag-en" onclick="setLang('en')">ğŸ‡ºğŸ‡¸</span>
    </div>

    <!-- HOME -->
    <div class="report-card" id="view-home">
      <div class="official-seal">ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤</div>
      <h1 id="ui-title">ìš´ëª…ê³µí•™ ë°ì´í„° ë¶„ì„</h1>
      <p id="ui-desc" style="font-size:0.85rem; color:#888; margin-bottom:40px;">ì„±ëª…ê³¼ íƒ„ìƒì¼ì„ ê¸°ë°˜ìœ¼ë¡œ ì—ë„ˆì§€ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</p>
      <input type="text" id="userName" placeholder="ì„±í•¨" autocomplete="name">
      <input type="text" id="userBirth" placeholder="ì–‘ë ¥ 8ìë¦¬ 19901208" inputmode="numeric" autocomplete="bday">
      <button class="btn-action" id="ui-btn" onclick="startAnalysis()">ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°</button>

      <div class="visitor-counter">ë¶„ì„ ì™„ë£Œëœ ìš´ëª…: <span id="visit-count">...</span>ê±´</div>
<div style="margin-top: 18px; display: flex; justify-content: center;">
  <ins class="kakao_ad_area" style="display:none;"
    data-ad-unit="DAN-gySJpKsnNTQ1FIIF"
    data-ad-width="320"
    data-ad-height="50"></ins>
</div>
    </div>

    <!-- RESULT -->
    <div class="report-card hidden" id="view-result">
      <div class="official-seal">ì •ì‹ë¶„ì„ë³¸</div>
      <h1 id="dynamic-title">ë¶„ì„ ë¦¬í¬íŠ¸</h1>
      <div id="radarChart" style="margin:0 auto 15px; width:220px; height:220px;"></div>
      <div class="summary-line" id="dynamic-summary">ë¶„ì„ ì¤‘...</div>

      <div class="tabs">
        <button class="tab-btn active" id="tab1" onclick="switchTab('fortune', this)">í˜„ìƒ ë¶„ì„ì„œ</button>
        <button class="tab-btn" id="tab2" onclick="switchTab('past', this)">ì „ìƒ ê¸°ë¡ì„œ</button>
        <button class="tab-btn" id="tab3" onclick="switchTab('next', this)">ë‚´ì„¸ ì˜ˆì•½ì„œ</button>
      </div>

      <div id="tab-body"></div>


      <button class="btn-action" style="margin-top:30px; background:white; color:#444; border:1px solid #DDD;" onclick="copyLink()">ë§í¬ ë³µì‚¬</button>
      <p onclick="location.href=location.pathname" style="font-size:0.7rem; color:#CCC; margin-top:20px; cursor:pointer;">ì´ˆê¸°í™”</p>
    </div>
  </div>

  <!-- âœ… ë°ì´í„°ì…‹: quotes.js (ë°˜ë“œì‹œ ê°™ì€ í´ë”ì—) -->
  <script src="quotes.js"></script>

  <script>
    let currentLang = 'ko';
    let session = { name: '', birth: '', seed: 0, scores: [], nameReport: '' };
    const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];

    function assertDataset() {
      if (typeof i18n === 'undefined') {
        alert("quotes.js ë¡œë“œ ì‹¤íŒ¨(ë˜ëŠ” i18n ëˆ„ë½). ê°™ì€ í´ë”ì— quotes.jsê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
        return false;
      }
      return true;
    }
    
async function updateCounter() {
  const el = document.getElementById('visit-count');
  if (!el) return;

  try {
    const res = await fetch('https://countapi.mileshilliard.com/api/v1/hit/volcanohawaii-my-helpful-quote-visits');
    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    const data = await res.json();
    el.innerText = Number(data.value).toLocaleString();
  } catch (e) {
    el.innerText = "â€”";
  }
}
    window.addEventListener('DOMContentLoaded', () => {
  updateCounter();
  // ë‹¤ë¥¸ ì´ˆê¸°í™” ì½”ë“œê°€ ìˆìœ¼ë©´ ê°™ì´
});
    function setLang(lang) {
      if (!assertDataset()) return;
      currentLang = lang;

      document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
      document.getElementById(`flag-${lang}`).classList.add('active');

      const t = i18n[lang];
      document.getElementById('ui-title').innerText = t.title;
      document.getElementById('ui-desc').innerText = t.desc;
      document.getElementById('userName').placeholder = t.nameLabel;
      document.getElementById('userBirth').placeholder = t.birthLabel;
      document.getElementById('ui-btn').innerText = t.btn;

      document.getElementById('load-seal').innerText = t.loadSeal;
      document.getElementById('load-title').innerText = t.loadTitle;
      document.getElementById('load-desc').innerText = t.loadDesc;

      document.getElementById('tab1').innerText = t.tab1Btn;
      document.getElementById('tab2').innerText = t.tab2Btn;
      document.getElementById('tab3').innerText = t.tab3Btn;

      if (session.name) processData(session.name, session.birth, { keepView: true });
    }

    function startAnalysis() {
      if (!assertDataset()) return;

      const n = document.getElementById('userName').value.trim();
      const bRaw = document.getElementById('userBirth').value.trim();
      const b = bRaw.replace(/\D/g, '');

      if (!n || b.length !== 8) {
        alert(currentLang === 'ko' ? "ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”." : "Check inputs.");
        return;
      }

      const year = parseInt(b.substring(0, 4), 10);
      if (Number.isNaN(year) || year < 1000 || year > 2150) {
        alert(currentLang === 'ko' ? "ì—°ë„ ë²”ìœ„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”." : "Check year.");
        return;
      }

      // âœ… display:none ëŒ€ì‹  class í† ê¸€
      document.getElementById('loading-overlay').classList.add('show');

      setTimeout(() => {
        document.getElementById('loading-overlay').classList.remove('show');
        processData(n, b);
      }, 2500);
    }

    function processData(name, birth, opts = {}) {
      const cleanName = name.replace(/<[^>]*>?/gm, '');
      session.name = cleanName;
      session.birth = birth;

      session.seed = cleanName.split('').reduce((a, ch) => a + ch.charCodeAt(0), 0) + parseInt(birth, 10);

      let sc = [40, 40, 40, 40, 40];

      for (let i = 0; i < cleanName.length; i++) {
        const char = cleanName[i];
        const onset = /[a-zA-Z]/.test(char) ? char.toUpperCase() : getHangulOnset(char);
        const el = /[a-zA-Z]/.test(char) ? alphabetElements[onset] : hangulElements[onset];
        if (el && elements.includes(el)) sc[elements.indexOf(el)] += 35;
      }

      const month = parseInt(birth.substring(4, 6), 10);
      const monthOrder = [11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
      const monthIdx = monthOrder.indexOf(month);
      if (monthIdx >= 0) sc[monthIdx % 5] += 25;

      session.scores = sc.map((s, i) => s + ((session.seed + i) % 15));
      const maxIdx = session.scores.indexOf(Math.max(...session.scores));
      const strongEl = elements[maxIdx];
      const lv = getLevel(session.scores[maxIdx]);

      document.getElementById('dynamic-title').innerText =
        currentLang === 'ko' ? `[${cleanName}]ë‹˜ì˜ ìš´ëª… ë¦¬í¬íŠ¸` : `Report for [${cleanName}]`;

      document.getElementById('dynamic-summary').innerText =
        currentLang === 'ko' ? nicknamesKo[strongEl][lv] : nicknamesEn[strongEl][lv];

      const res = nameNumerology[(session.seed % 25) + 1];
      session.nameReport =
        currentLang === 'ko'
          ? `ì„±ëª…í•™ì ìœ¼ë¡œ <b>${res.title}</b>ì´ë©°, ${res.desc}`
          : `Numerologically: <b>${res.titleEn}</b>. ${res.descEn}`;

      if (!opts.keepView) {
        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-result').classList.remove('hidden');
      }

      renderChart();
      switchTab('fortune', document.getElementById('tab1'));
    }

    function getHangulOnset(char) {
      const code = char.charCodeAt(0);
      const c = code - 44032;
      if (c < 0 || c > 11171) return char;
      const onsets = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
      return onsets[Math.floor(c / 588)];
    }

    function getLevel(sc) {
      if (sc >= 110) return 'veryStrong';
      if (sc >= 80) return 'strong';
      if (sc >= 50) return 'normal';
      if (sc >= 20) return 'weak';
      return 'veryWeak';
    }

    function renderChart() {
      const labels = currentLang === 'ko' ? ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"] : ["Wood", "Fire", "Earth", "Metal", "Water"];
      const cx = 110, cy = 110, r = 75;
      const maxIdx = session.scores.indexOf(Math.max(...session.scores));

      const themeColor = {
        "æœ¨": { fill: "rgba(46, 204, 113, 0.3)", stroke: "#27ae60" },
        "ç«": { fill: "rgba(231, 76, 60, 0.3)", stroke: "#c0392b" },
        "åœŸ": { fill: "rgba(241, 196, 15, 0.3)", stroke: "#f39c12" },
        "é‡‘": { fill: "rgba(149, 165, 166, 0.3)", stroke: "#7f8c8d" },
        "æ°´": { fill: "rgba(52, 152, 219, 0.3)", stroke: "#2980b9" }
      }[elements[maxIdx]];

      let poly = "";
      labels.forEach((_, i) => {
        const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
        const v = (session.scores[i] / 150) * r;
        poly += `${cx + v * Math.cos(a)},${cy + v * Math.sin(a)} `;
      });

      const textLabels = labels.map((l, i) => {
        const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
        const tx = cx + (r + 25) * Math.cos(a), ty = cy + (r + 25) * Math.sin(a);
        return `<text x="${tx}" y="${ty}" text-anchor="middle" dominant-baseline="middle" fill="#243447" font-size="12" font-weight="700">${l}</text>`;
      }).join('');

      document.getElementById('radarChart').innerHTML =
        `<svg viewBox="0 0 220 220" style="overflow:visible;">
          <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="#EEE"/>
          ${textLabels}
          <polygon points="${poly}" fill="${themeColor.fill}" stroke="${themeColor.stroke}" stroke-width="2"/>
        </svg>`;
    }

    function switchTab(mode, btn) {
      if (!assertDataset()) return;

      if (btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      }

      const body = document.getElementById('tab-body');
      const s = session.seed;
      const t = i18n[currentLang];

      if (mode === 'fortune') {
        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const minIdx = session.scores.indexOf(Math.min(...session.scores));
        const strongEl = elements[maxIdx];
        const lackEl = elements[minIdx];

        const presSource = currentLang === 'ko' ? elementPrescriptions : enPrescriptions;
        const attrSource = currentLang === 'ko' ? elementAttributesKo : elementAttributesEn;
        const sideSource = currentLang === 'ko' ? sideEffects : sideEffectsEn;
        const quoteSource = currentLang === 'ko' ? quoteData["ì¸ìƒ"] : quoteDataEn["life"];

        const masterSideIdx = s % sideSource.length;
        const masterQuoteIdx = s % quoteSource.length;

        body.innerHTML = `
          <div class="tab-content">
            <div class="section-wrap">
              <span class="section-title">${t.sec1}</span>
              <div class="info-box">${session.nameReport}</div>
            </div>

            <div class="section-wrap">
              <span class="section-title">${t.sec2}</span>
              <div>â€¢ <b>${currentLang==='ko'?'ì£¼ëœ ì—ë„ˆì§€':'Core Energy'}:</b> ${attrSource[strongEl].name} (${attrSource[strongEl].trait})</div>
              <div>â€¢ <b>${t.advise}:</b> ${presSource[strongEl][getLevel(session.scores[maxIdx])]}</div>
            </div>

            <div class="section-wrap">
              <span class="section-title">${t.sec3}</span>
              <div>â€¢ <b>${t.practice}:</b> ${presSource[lackEl][getLevel(session.scores[minIdx])]}</div>
            </div>

            <div class="warning-box"><b>âš ï¸ ${t.sideEffect}</b><br>${sideSource[masterSideIdx]}</div>
            <div style="margin-top:30px; text-align:center; color:#AAA; font-style:italic;">"${quoteSource[masterQuoteIdx].text}"</div>
          </div>`;
      } else if (mode === 'past') {
        const pastSource = currentLang === 'ko' ? pastLifeData : pastLifeDataEn;
        const p = pastSource[s % pastSource.length];
        body.innerHTML = `
          <div class="tab-content">
            <span class="section-title">${t.tab2Title}</span>
            <div class="info-box">
              <b>ğŸ“œ ${t.pastJob}:</b> [${p.job}]<br>${p.desc}<br><br>
              <b>âœ¨ ${t.pastHomework}:</b><br>${p.homework}
            </div>
          </div>`;
      } else {
        const nextSource = currentLang === 'ko' ? reincarnationData : reincarnationDataEn;
        const r = nextSource[s % nextSource.length];
        body.innerHTML = `
          <div class="tab-content">
            <span class="section-title">${t.tab3Title}</span>
            <div class="info-box">
              <b>ğŸ“ ${t.nextDest}:</b> ${r.place}<br>
              <b>ğŸ§¬ ${t.nextObj}:</b> ${r.object}<br><br>
              <b>âœ… ${t.nextMission}:</b><br>${r.mission}
            </div>
          </div>`;
      }
    }

    async function copyLink() {
      const base = window.location.origin + window.location.pathname;
      const url = base + `?name=${encodeURIComponent(session.name)}&birth=${encodeURIComponent(session.birth)}&lang=${encodeURIComponent(currentLang)}`;

      try {
        await navigator.clipboard.writeText(url);
        alert(currentLang === 'ko' ? "ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!" : "Link copied!");
      } catch {
        const ta = document.createElement('textarea');
        ta.value = url;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        alert(currentLang === 'ko' ? "ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!" : "Link copied!");
      }
    }

    function initFromQuery() {
      if (!assertDataset()) return;

      const p = new URLSearchParams(window.location.search);
      const qLang = p.get('lang');
      const qName = p.get('name');
      const qBirth = p.get('birth');

      if (qLang === 'en' || qLang === 'ko') setLang(qLang);

      if (qName) document.getElementById('userName').value = qName;
      if (qBirth) document.getElementById('userBirth').value = qBirth;

      if (qName && qBirth && String(qBirth).replace(/\D/g,'').length === 8) {
        processData(qName, String(qBirth).replace(/\D/g,''));
        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-result').classList.remove('hidden');
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      updateCounter();
      if (assertDataset()) {
        setLang('ko');
        initFromQuery();
      }
    });
  </script>
 <script async src="https://t1.daumcdn.net/kas/static/ba.min.js"></script>
</body>
</html>
