<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>운명 공학 리포트</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F4F2EE;
            --paper: #FFFFFF;
            --primary: #2C3E50; /* 깊은 네이비 */
            --accent: #A68A64;  /* 차분한 골드 브라운 */
            --text: #3E3E3E;
            --border: #E5E1DA;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }

        .container { width: 100%; max-width: 450px; padding: 20px; }

        .report-card {
            background: var(--paper);
            border-radius: 8px;
            padding: 50px 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.06);
            border: 1px solid var(--border);
            text-align: center;
        }

        h1 { font-family: 'Gowun Batang', serif; font-size: 1.7rem; color: var(--primary); margin: 0 0 10px 0; font-weight: 700; }
        .sub-desc { font-size: 0.85rem; color: var(--accent); letter-spacing: 3px; text-transform: uppercase; margin-bottom: 40px; }

        /* 입력 폼 */
        .form-area { text-align: left; margin-bottom: 30px; }
        .label { font-size: 0.8rem; font-weight: 600; color: var(--primary); margin-bottom: 8px; display: block; }
        input {
            width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 4px;
            font-size: 1rem; margin-bottom: 20px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); }

        .btn-start {
            width: 100%; padding: 18px; background: var(--primary); color: white; border: none;
            border-radius: 4px; font-family: 'Gowun Batang', serif; font-size: 1.1rem; font-weight: 700;
            cursor: pointer; transition: 0.3s;
        }
        .btn-start:hover { background: #1a252f; }

        .hidden { display: none; }

        /* 결과창 요소 */
        .chart-wrap { margin: 30px auto; width: 220px; height: 220px; }
        .type-tag { font-family: 'Gowun Batang', serif; font-size: 1.2rem; color: var(--accent); font-weight: 700; margin-bottom: 10px; display: block; }

        .tabs { display: flex; border-bottom: 1px solid var(--border); margin: 30px 0 20px; }
        .tab-btn {
            flex: 1; padding: 12px 0; border: none; background: none; cursor: pointer;
            font-family: 'Gowun Batang', serif; font-size: 0.95rem; color: #999; position: relative;
        }
        .tab-btn.active { color: var(--primary); font-weight: 700; }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--primary);
        }

        .tab-content { text-align: left; line-height: 1.8; font-size: 0.95rem; min-height: 200px; color: #555; }
        .section-title { font-family: 'Gowun Batang', serif; font-size: 1.1rem; color: var(--primary); display: block; margin-bottom: 15px; border-left: 3px solid var(--accent); padding-left: 10px; }

        /* 처방전 명언 푸터 */
        .quote-footer {
            margin-top: 30px; padding-top: 20px; border-top: 1px dashed var(--border);
            font-family: 'Gowun Batang', serif; font-size: 0.9rem; color: var(--accent);
            text-align: center; line-height: 1.5; font-style: italic;
        }

        .btn-share {
            margin-top: 30px; background: none; border: 1px solid var(--border);
            padding: 10px 20px; border-radius: 30px; font-size: 0.8rem; color: #888; cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="report-card" id="view-home">
        <h1>운명 분석 보고서</h1>
        <div class="sub-desc">Attribute Engineering</div>
        
        <div class="form-area">
            <span class="label">성함</span>
            <input type="text" id="userName" placeholder="성함을 입력하세요">
            <span class="label">생년월일 (8자리)</span>
            <input type="text" id="userBirth" placeholder="예: 19920815">
        </div>
        
        <button class="btn-start" onclick="analyze()">데이터 분석 시작</button>
    </div>

    <div class="report-card hidden" id="view-result">
        <span id="res-name-label" style="font-size: 0.8rem; color: #999;">ANALYSIS REPORT</span>
        <h1 id="res-title">분석 결과</h1>
        <div class="chart-wrap" id="radarChart"></div>
        <span class="type-tag" id="res-type">기운 분석 중...</span>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('fortune', this)">현생 처방</button>
            <button class="tab-btn" onclick="switchTab('past', this)">전생 숙제</button>
            <button class="tab-btn" onclick="switchTab('next', this)">환생 예약</button>
        </div>

        <div class="tab-content" id="tab-body"></div>

        <button class="btn-share" onclick="copyUrl()">리포트 링크 복사하기</button>
        <p onclick="location.reload()" style="font-size:0.75rem; color:#ccc; margin-top:20px; cursor:pointer; text-decoration:underline;">새로운 데이터 입력</p>
    </div>
</div>

<script src="quotes.js"></script>
<script>
    let session = { name: '', birth: '', seed: 0, scores: [] };

    function analyze() {
        const name = document.getElementById('userName').value.trim();
        const birth = document.getElementById('userBirth').value.trim();

        if(!name || birth.length !== 8) {
            alert("성함과 8자리 생년월일을 정확히 입력해 주세요.");
            return;
        }

        session.name = name;
        session.birth = birth;
        session.seed = name.split('').reduce((a,b)=>a+b.charCodeAt(0),0) + parseInt(birth);
        
        // 오행 점수 생성 로직
        session.scores = [];
        let tSeed = session.seed;
        for(let i=0; i<5; i++) {
            tSeed = (tSeed * 16807) % 2147483647;
            session.scores.push(30 + (tSeed % 55)); 
        }

        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-result').classList.remove('hidden');
        
        drawChart();
        switchTab('fortune', document.querySelector('.tab-btn.active'));
    }

    function drawChart() {
        const labels = ["木(나무)", "火(불)", "土(흙)", "金(쇠)", "水(물)"];
        const c = 110, r = 85;
        let points = "";
        
        labels.forEach((l, i) => {
            const angle = (Math.PI * 2 / 5) * i - (Math.PI / 2);
            const val = (session.scores[i] / 100) * r;
            points += `${c + val * Math.cos(angle)},${c + val * Math.sin(angle)} `;
        });

        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        document.getElementById('res-type').innerText = `${labels[maxIdx].split('(')[1].replace(')', '')}의 속성이 강한 운명`;

        document.getElementById('radarChart').innerHTML = `
            <svg viewBox="0 0 220 220" style="overflow:visible;">
                <polygon points="${getGrid(c, r)}" fill="none" stroke="#EEE" />
                <polygon points="${getGrid(c, r*0.6)}" fill="none" stroke="#EEE" />
                ${labels.map((l, i) => {
                    const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
                    return `<line x1="${c}" y1="${c}" x2="${c + r * Math.cos(a)}" y2="${c + r * Math.sin(a)}" stroke="#EEE" />
                            <text x="${c + (r+25) * Math.cos(a)}" y="${c + (r+25) * Math.sin(a)}" text-anchor="middle" font-size="10" fill="#999">${l}</text>`;
                }).join('')}
                <polygon points="${points}" fill="rgba(166, 138, 100, 0.3)" stroke="var(--accent)" stroke-width="2" />
            </svg>
        `;
    }

    function getGrid(c, r) {
        let p = "";
        for(let i=0; i<5; i++) {
            const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
            p += `${c + r * Math.cos(a)},${c + r * Math.sin(a)} `;
        }
        return p;
    }

    function switchTab(mode, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const body = document.getElementById('tab-body');
        const s = session.seed;

        if(mode === 'fortune') {
            const q = quoteData["인생"][s % quoteData["인생"].length];
            body.innerHTML = `
                <span class="section-title">현생의 에너지 처방</span>
                ${session.name}님의 현재 기운은 균형을 찾아가는 과정에 있습니다. <br>
                분석된 보강 지침을 전달합니다.<br><br>
                • <b>권장 행동:</b> ${recommendations[s % recommendations.length]}<br>
                • <b>기운의 색상:</b> ${["청색", "적색", "황색", "백색", "흑색"][s % 5]} 계열<br>
                • <b>유의 요소:</b> ${sideEffects[s % sideEffects.length].split(' ')[0]} 주의
                <div class="quote-footer">
                    "${q.text}"
                </div>
            `;
        } else if(mode === 'past') {
            const p = pastLifeData[s % pastLifeData.length];
            body.innerHTML = `
                <span class="section-title">전생 에너지 이력</span>
                귀하의 에너지는 과거 <b>[${p.job}]</b>의 소명을 기록하고 있습니다. <br><br>
                - ${p.desc}<br><br>
                <b>남겨진 숙제:</b><br>
                "${p.homework}"
            `;
        } else {
            const r = reincarnationData[s % reincarnationData.length];
            body.innerHTML = `
                <span class="section-title">차기 생 예약 확약서</span>
                다음 생으로의 에너지 전이 경로가 확정되었습니다.<br><br>
                • <b>행선지:</b> ${r.place}<br>
                • <b>재탄생 형태:</b> ${r.object}<br>
                • <b>확정 조건:</b> ${r.mission}
            `;
        }
    }

    function copyUrl() {
        const t = document.createElement("textarea");
        document.body.appendChild(t);
        t.value = `${session.name}님의 운명 분석 리포트 확인: ${window.location.href}`;
        t.select();
        document.execCommand("copy");
        document.body.removeChild(t);
        alert("리포트 링크가 복사되었습니다.");
    }
</script>
</body>
</html>
