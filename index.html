<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destiny Lab</title>
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://t1.daumcdn.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data: https://api.countapi.xyz; frame-src https://t1.daumcdn.net https://display.adfit.kakao.com; connect-src https://api.countapi.xyz;">

    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        :root { --bg: #F0EDE9; --paper: #FFFFFF; --primary: #243447; --accent: #9A8467; --text: #444444; --border: #D1CDC5; }
        
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; overflow-x: hidden; position: relative; }

        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;
            background-image: radial-gradient(circle at center, rgba(255, 255, 255, 0.9) 0.5px, transparent 1.2px), radial-gradient(circle at center, rgba(154, 132, 103, 0.4) 1px, transparent 2px);
            background-size: 50px 50px, 100px 100px; background-position: 0 0, 30px 30px; opacity: 0.4; animation: twinkle 5s ease-in-out infinite alternate;
        }
        @keyframes twinkle { 0% { opacity: 0.2; transform: translateY(0); } 100% { opacity: 0.6; transform: translateY(-8px); } }

        .container { width: 100%; max-width: 480px; position: relative; z-index: 1; }
        .lang-toggle { position: absolute; top: -50px; right: 0; display: flex; gap: 15px; }
        .flag { font-size: 1.6rem; cursor: pointer; opacity: 0.4; filter: grayscale(100%); transition: 0.3s; }
        .flag.active { opacity: 1; filter: grayscale(0%); transform: scale(1.2); }
        .report-card { background: var(--paper); padding: 55px 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); border: 1px solid var(--border); text-align: center; position: relative; animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .official-seal { position: absolute; top: 25px; right: 25px; width: 65px; height: 65px; border: 2px double var(--accent); color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Gowun Batang', serif; font-size: 0.7rem; font-weight: 700; opacity: 0.5; transform: rotate(12deg); pointer-events: none; }
        
        h1 { font-family: 'Gowun Batang', serif; font-size: 1.5rem; color: var(--primary); margin: 0 0 10px 0; word-break: keep-all; }
        .summary-line { font-family: 'Gowun Batang', serif; font-size: 1rem; color: var(--accent); margin-bottom: 30px; font-weight: 600; }
        .tab-content { text-align: left; line-height: 1.9; font-size: 0.95rem; }
        .section-wrap { margin-bottom: 35px; }
        .section-title { font-family: 'Gowun Batang', serif; font-size: 1.05rem; color: var(--accent); display: block; margin-bottom: 15px; font-weight: 700; border-bottom: 1px solid #F0F0F0; padding-bottom: 8px; }
        .info-box { background: #F9F8F6; padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 15px; }
        .warning-box { background: #FFF5F5; padding: 18px; border-radius: 8px; font-size: 0.85rem; color: #C0392B; border: 1px dashed #FADBD8; margin-top: 25px; }
        .tabs { display: flex; border-bottom: 1px solid #EEE; margin: 30px 0; }
        .tab-btn { flex: 1; padding: 12px 0; border: none; background: none; cursor: pointer; font-size: 0.9rem; color: #BBB; font-family: 'Gowun Batang'; }
        .tab-btn.active { color: var(--primary); font-weight: 700; border-bottom: 2px solid var(--primary); }
        .btn-action { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 1rem; }
        .hidden { display: none; }
        input { width: 100%; padding: 15px; margin-bottom: 20px; border: none; border-bottom: 1px solid #DDD; font-size: 1.1rem; outline: none; }
        
        .visitor-counter { margin-top: 25px; font-size: 0.75rem; color: #AAA; font-family: 'Gowun Batang'; border-top: 1px solid #F5F5F5; padding-top: 15px; }
        .visitor-count-num { color: var(--accent); font-weight: 700; transition: all 1s; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

<div id="loading-overlay" style="position:fixed; inset:0; width:100%; height:100dvh; background:rgba(240, 237, 233, 0.96); z-index:9999; display:none; align-items:center; justify-content:center; padding:20px; backdrop-filter: blur(2px);">
    <div style="background:white; padding:40px 15px; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.05); border:1px solid #D1CDC5; width:100%; max-width:340px; min-width:320px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-sizing:border-box;">
        <div id="load-seal" class="official-seal" style="position:static; margin-bottom:20px; opacity:1;">ë¶„ì„ì¤‘</div>
        <h2 id="load-title" style="font-family:'Gowun Batang'; color:var(--primary); font-size:1.1rem; margin-bottom:8px; width:100%; text-align:center;">ìš´ëª…ì˜ ì—ë„ˆì§€ë¥¼ ì¡°í•© ì¤‘...</h2>
        <p id="load-desc" style="color:#888; font-size:0.8rem; margin-bottom:25px; width:100%; text-align:center;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
        <div style="width:300px; height:250px; background:#f9f9f9; display:flex; align-items:center; justify-content:center; border-radius:8px; overflow:hidden; flex-shrink:0;">
            <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-pMoVBneQCSicnBZ7" data-ad-width = "300" data-ad-height = "250"></ins>
            <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        </div>
        <div style="margin-top:25px; border:3px solid #f3f3f3; border-top:3px solid var(--accent); border-radius:50%; width:24px; height:24px; animation:spin 1s linear infinite;"></div>
    </div>
</div>

<div class="container">
    <div class="lang-toggle">
        <span class="flag active" id="flag-ko" onclick="setLang('ko')">ğŸ‡°ğŸ‡·</span>
        <span class="flag" id="flag-en" onclick="setLang('en')">ğŸ‡ºğŸ‡¸</span>
    </div>

    <div class="report-card" id="view-home">
        <div class="official-seal" id="seal-home">ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤</div>
        <h1 id="ui-title">ì„±ëª…í•™ ë°ì´í„° ë¶„ì„</h1>
        <p id="ui-desc" style="font-size:0.85rem; color:#888; margin-bottom:40px; line-height:1.6; word-break:keep-all; padding:0 10px;">ì´ë¦„ì˜ íŒŒë™ ì—ë„ˆì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ì£¼ì˜ ê³„ì ˆì  ìš”ì¸ì„ ê²°í•©í•˜ì—¬ ê³ ìœ í•œ ìš´ëª… ê¸°ìš´ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>
        
        <input type="text" id="userName" placeholder="ì„±í•¨">
        <input type="text" id="userBirth" placeholder="ì–‘ë ¥ ìƒë…„ì›”ì¼ 8ìë¦¬" onkeyup="if(event.key==='Enter'){startAnalysis()}">
        <button class="btn-action" id="ui-btn" onclick="startAnalysis()">ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°</button>

        <div class="visitor-counter" id="visitor-ui">
            ì§€ê¸ˆê¹Œì§€ <span class="visitor-count-num" id="visit-count">...</span>ëª…ì´ ë¶„ì„ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.
        </div>

        <div style="margin-top: 30px; display: flex; justify-content: center;">
            <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-gySJpKsnNTQ1FIIF" data-ad-width = "320" data-ad-height = "50"></ins>
            <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        </div> 
    </div>

    <div class="report-card hidden" id="view-result">
        <div class="official-seal" id="seal-res">ì •ì‹ë¶„ì„ë³¸</div>
        <h1 id="dynamic-title">ë‹˜ì„ ìœ„í•œ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
        <div id="radarChart" style="margin:0 auto 20px; width:220px; height:220px;"></div>
        <div class="summary-line" id="dynamic-summary" style="margin-top: 10px;">ë¶„ì„ ì¤‘...</div>

        <div class="tabs">
            <button class="tab-btn active" id="tab1" onclick="switchTab('fortune', this)">í˜„ìƒ ë¶„ì„</button>
            <button class="tab-btn" id="tab2" onclick="switchTab('past', this)">ì „ìƒ ê¸°ë¡</button>
            <button class="tab-btn" id="tab3" onclick="switchTab('next', this)">ë‚´ì„¸ ì˜ˆì•½</button>
        </div>
        <div class="tab-content" id="tab-body"></div>

        <button class="btn-action" style="margin-top:30px; background:white; border:1px solid #DDD; color:#444;" id="ui-copy" onclick="copyLink()">ë§í¬ ë³µì‚¬</button>
        <p onclick="window.location.href=window.location.pathname" style="font-size:0.7rem; color:#CCC; margin-top:20px; cursor:pointer;" id="ui-reset">ì´ˆê¸°í™”</p>
    </div>
</div>

<script src="quotes.js"></script>
<script>
    // [i18n ë°ì´í„° ì—…ë°ì´íŠ¸] ì•ˆë‚´ ë¬¸êµ¬ ìˆ˜ì •ë¨
    const i18n = {
        ko: {
            title: "ì„±ëª…í•™ ë°ì´í„° ë¶„ì„",
            desc: "ì´ë¦„ì˜ íŒŒë™ ì—ë„ˆì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ì£¼ì˜ ê³„ì ˆì  ìš”ì¸ì„ ê²°í•©í•˜ì—¬ ê³ ìœ í•œ ìš´ëª… ê¸°ìš´ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.",
            nameLabel: "ì„±í•¨", birthLabel: "ì–‘ë ¥ ìƒë…„ì›”ì¼ 8ìë¦¬", btn: "ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°",
            reset: "ì´ˆê¸°í™”", tab1: "í˜„ìƒ ë¶„ì„", tab2: "ì „ìƒ ê¸°ë¡", tab3: "ë‚´ì„¸ ì˜ˆì•½", copy: "ë§í¬ ë³µì‚¬",
            sec1: "[ì„±ëª…í•™ì  í˜„ìƒ ë¶„ì„]", sec2: "[ê°•ì  ì˜¤í–‰ì˜ ê¸°ìš´]", sec3: "[ë¶€ì¡± ì˜¤í–‰ì˜ ë³´ì™„]",
            advise: "ìš´ëª…ì  ì¡°ì–¸", practice: "ê°œìš´ë²• ì‹¤ì²œ", sideEffect: "ê³¼ìœ ë¶ˆê¸‰ ì£¼ì˜",
            pastJob: "ì „ìƒì˜ ì§ì—…", pastHomework: "í˜„ìƒìœ¼ë¡œ ê°€ì ¸ì˜¨ ìˆ™ì œ",
            nextDest: "ë‹¤ìŒ ìƒì˜ ê±°ì²˜", nextObj: "í™˜ìƒí•  í˜•íƒœ", nextMission: "ë¶€ì—¬ë°›ì€ ì†Œëª…"
        },
        en: {
            title: "Destiny Data Analysis",
            desc: "Extracts unique destiny energy by combining name vibrations with seasonal Saju factors.",
            nameLabel: "Full Name", birthLabel: "Birthdate (YYYYMMDD)", btn: "Generate Report",
            reset: "Reset", tab1: "Present Life", tab2: "Past Life", tab3: "Next Life", copy: "Copy Link",
            sec1: "[Numerological Analysis]", sec2: "[Dominant Energy]", sec3: "[Lacking Energy]",
            advise: "Destiny Advice", practice: "How to Improve", sideEffect: "Warning",
            pastJob: "Past Job", pastHomework: "Karmic Homework",
            nextDest: "Next Destination", nextObj: "Next Form", nextMission: "Given Mission"
        }
    };

    let currentLang = 'ko';
    let session = { name: '', birth: '', seed: 0, scores: [], nameReport: '' };

    /* ë°©ë¬¸ì ì¹´ìš´í„° ì• ë‹ˆë©”ì´ì…˜ */
    async function updateCounter() {
        try {
            const res = await fetch('https://api.countapi.xyz/hit/destinylab.github.io/visits');
            const data = await res.json();
            const target = data.value;
            animateValue("visit-count", 0, target, 2000);
        } catch (e) {
            document.getElementById('visit-count').innerText = "1,245";
        }
    }

    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        const range = end - start;
        const startTime = new Date().getTime();
        const timer = setInterval(() => {
            const now = new Date().getTime();
            const progress = Math.min((now - startTime) / duration, 1);
            obj.innerText = Math.floor(progress * range + start).toLocaleString();
            if (progress === 1) clearInterval(timer);
        }, 30);
    }

    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
        document.getElementById(`flag-${lang}`).classList.add('active');
        const t = i18n[lang];
        document.getElementById('ui-title').innerText = t.title;
        document.getElementById('ui-desc').innerText = t.desc;
        document.getElementById('userName').placeholder = t.nameLabel;
        document.getElementById('userBirth').placeholder = t.birthLabel;
        document.getElementById('ui-btn').innerText = t.btn;
        document.getElementById('ui-reset').innerText = t.reset;
        document.getElementById('tab1').innerText = t.tab1;
        document.getElementById('tab2').innerText = t.tab2;
        document.getElementById('tab3').innerText = t.tab3;
        document.getElementById('ui-copy').innerText = t.copy;
        
        document.getElementById('visitor-ui').innerHTML = lang === 'ko' ? `ì§€ê¸ˆê¹Œì§€ <span class="visitor-count-num" id="visit-count">...</span>ëª…ì´ ë¶„ì„ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.` : `Total <span class="visitor-count-num" id="visit-count">...</span> destinies analyzed.`;
        updateCounter();

        const ls = document.getElementById('load-seal'), lt = document.getElementById('load-title'), ld = document.getElementById('load-desc');
        if (lang === 'en') { ls.innerText = "Analyzing"; lt.innerText = "Combining Destiny Energies..."; ld.innerText = "Please wait a moment."; } 
        else { ls.innerText = "ë¶„ì„ì¤‘"; lt.innerText = "ìš´ëª…ì˜ ì—ë„ˆì§€ë¥¼ ì¡°í•© ì¤‘..."; ld.innerText = "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”."; }
        document.getElementById('seal-home').innerHTML = lang === 'ko' ? "ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤" : "Destiny<br>Lab";
        document.getElementById('seal-res').innerText = lang === 'ko' ? "ì •ì‹ë¶„ì„ë³¸" : "OFFICIAL";
        if (session.name) { processData(session.name, session.birth); }
    }

    /* ì´í•˜ ë¡œì§ ìƒëµ (ê¸°ì¡´ 5ë‹¨ê³„ ì²™ë„ ë¡œì§ ìœ ì§€) */
    // [ì¤‘ìš”] ê¸°ì¡´ ì½”ë“œì˜ nicknamesKo, elementPrescriptions, processData ë“±ì„ ì´ ì•„ë˜ì— ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
</script>
</body>
</html>
