<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš´ëª… ê³µí•™ ë¶„ì„ê´€</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        :root {
            --bg: #F0EDE9;
            --paper: #FFFFFF;
            --primary: #243447;
            --accent: #9A8467;
            --text: #444444;
            --border: #D1CDC5;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container { width: 100%; max-width: 480px; position: relative; }

        .report-card {
            background: var(--paper);
            padding: 60px 35px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            text-align: center;
            position: relative;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .official-seal {
            position: absolute; top: 25px; right: 25px;
            width: 65px; height: 65px; border: 2px double var(--accent);
            color: var(--accent); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Gowun Batang', serif; font-size: 0.75rem; font-weight: 700;
            opacity: 0.5; transform: rotate(12deg); pointer-events: none;
        }

        h1 { font-family: 'Gowun Batang', serif; font-size: 1.8rem; color: var(--primary); margin: 0 0 10px 0; letter-spacing: -1px; }
        .serial-num { font-size: 0.7rem; color: #AAA; letter-spacing: 2px; margin-bottom: 45px; display: block; }

        .form-area { text-align: left; margin-bottom: 40px; }
        .label { font-size: 0.75rem; font-weight: 700; color: var(--primary); margin-bottom: 8px; display: block; letter-spacing: 1px; }
        input {
            width: 100%; padding: 16px; border: none; border-bottom: 1px solid var(--border);
            font-size: 1.1rem; margin-bottom: 30px; outline: none; background: transparent; transition: 0.3s;
            font-family: 'Gowun Batang', serif;
        }
        input:focus { border-bottom-color: var(--primary); background: #FAF9F7; }

        .btn-start {
            width: 100%; padding: 20px; background: var(--primary); color: white; border: none;
            font-family: 'Gowun Batang', serif; font-size: 1.1rem; font-weight: 700;
            cursor: pointer; letter-spacing: 2px; transition: 0.4s;
        }
        .btn-start:hover { background: #151f2b; letter-spacing: 4px; }

        .loader { margin: 40px 0; display: none; }
        .loader-dot { display: inline-block; width: 10px; height: 10px; background: var(--accent); border-radius: 50%; margin: 0 5px; animation: dotPulse 1.5s infinite; }
        @keyframes dotPulse { 0%, 100% { opacity: 0.2; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.1); } }

        .hidden { display: none; }

        .chart-wrap { margin: 30px auto; width: 240px; height: 240px; }
        .type-tag { font-family: 'Gowun Batang', serif; font-size: 1.3rem; color: var(--accent); font-weight: 700; margin-bottom: 10px; display: block; }

        .tabs { display: flex; border-bottom: 1px solid #EEE; margin: 40px 0 25px; }
        .tab-btn {
            flex: 1; padding: 15px 0; border: none; background: none; cursor: pointer;
            font-family: 'Gowun Batang', serif; font-size: 0.95rem; color: #BBB; position: relative;
        }
        .tab-btn.active { color: var(--primary); font-weight: 700; }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--primary);
        }

        .tab-content { text-align: left; line-height: 1.9; font-size: 1rem; min-height: 220px; color: #444; }
        .section-title { font-family: 'Gowun Batang', serif; font-size: 1.1rem; color: var(--accent); display: block; margin-bottom: 15px; font-weight: 700; }

        .quote-footer {
            margin-top: 40px; padding: 25px; background: #FBF9F7; border-radius: 8px;
            font-family: 'Gowun Batang', serif; font-size: 1rem; color: #555;
            text-align: center; line-height: 1.6; font-style: italic;
        }

        .btn-share {
            margin-top: 40px; background: transparent; border: 1px solid var(--border);
            padding: 14px 30px; border-radius: 4px; font-size: 0.85rem; color: #888; cursor: pointer;
            letter-spacing: 1px; transition: 0.3s;
        }
        .btn-share:hover { background: #F4F2EE; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <div class="report-card" id="view-home">
        <div class="official-seal">ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤</div>
        <span class="serial-num">ANALYSIS CASE NO. 2026-X</span>
        <h1>ìš´ëª… ë°ì´í„° ë¶„ì„</h1>
        <p style="font-size: 0.9rem; color: #888; margin-bottom: 45px;">ì„±ëª…í•™ê³¼ ëª…ë¦¬í•™ì„ ë°”íƒ•ìœ¼ë¡œ ì •ì‹ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
        
        <div class="form-area">
            <span class="label">ì„±ëª… (NAME)</span>
            <input type="text" id="userName" placeholder="ì„±í•¨ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤">
            <span class="label">ìƒë…„ì›”ì¼ (BIRTHDAY)</span>
            <input type="text" id="userBirth" placeholder="8ìë¦¬ (ì˜ˆ: 19940512)">
        </div>

        <div id="loader" class="loader">
            <div class="loader-dot" style="animation-delay: 0s"></div>
            <div class="loader-dot" style="animation-delay: 0.2s"></div>
            <div class="loader-dot" style="animation-delay: 0.4s"></div>
            <p style="font-size: 0.8rem; color: var(--accent); margin-top: 15px; font-family: 'Gowun Batang'">ê¸°ìš´ì˜ íë¦„ì„ ìˆ˜ì¹˜í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>

        <button id="btn-submit" class="btn-start" onclick="startAnalysis()">ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°</button>
    </div>

    <div class="report-card hidden" id="view-result">
        <div class="official-seal">ì •ì‹ë¶„ì„ë³¸</div>
        <span class="serial-num" id="res-id">REF. #00000000</span>
        <h1 id="res-header">ë¶„ì„ ê²°ê³¼ ë¦¬í¬íŠ¸</h1>
        <div class="chart-wrap" id="radarChart"></div>
        <span class="type-tag" id="res-type">ê¸°ìš´ ë¶„ì„ ì™„ë£Œ</span>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('fortune', this)">í˜„ìƒ ì²˜ë°©</button>
            <button class="tab-btn" onclick="switchTab('past', this)">ì „ìƒ ê¸°ë¡</button>
            <button class="tab-btn" onclick="switchTab('next', this)">ë‚´ì„¸ ì˜ˆì•½</button>
        </div>

        <div class="tab-content" id="tab-body"></div>

        <button class="btn-share" onclick="copyLink()">ê²°ê³¼ ë§í¬ ë³µì‚¬</button>
        <p onclick="location.reload()" style="font-size:0.75rem; color:#ccc; margin-top:30px; cursor:pointer; text-decoration:underline;">ë°ì´í„° ì´ˆê¸°í™”</p>
    </div>
</div>

<script src="quotes.js"></script>
<script>
    let session = { name: '', birth: '', seed: 0, scores: [] };

    function startAnalysis() {
        const name = document.getElementById('userName').value.trim();
        const birth = document.getElementById('userBirth').value.trim();
        if(!name || birth.length !== 8) { alert("ì •í™•í•œ ì„±ëª…ê³¼ 8ìë¦¬ ìƒë…„ì›”ì¼ì„ ê¸°ì…í•´ì£¼ì‹­ì‹œì˜¤."); return; }

        document.getElementById('btn-submit').style.display = 'none';
        document.getElementById('loader').style.display = 'block';

        setTimeout(() => { processData(name, birth); }, 2000);
    }

    function processData(name, birth) {
        session.name = name;
        session.birth = birth;
        session.seed = name.split('').reduce((a,b)=>a+b.charCodeAt(0),0) + parseInt(birth);
        
        const month = parseInt(birth.substring(4, 6));
        const firstChar = name.trim().charAt(0);
        let scores = [40, 40, 40, 40, 40]; // ëª©, í™”, í† , ê¸ˆ, ìˆ˜

        if([2, 3].includes(month)) scores[0] += 30;
        else if([5, 6].includes(month)) scores[1] += 30;
        else if([8, 9].includes(month)) scores[3] += 30;
        else if([11, 12].includes(month)) scores[4] += 30;
        else scores[2] += 30;

        const onset = getHangulOnset(firstChar); 
        if(['ã„±','ã…‹'].includes(onset)) scores[0] += 15;
        else if(['ã„´','ã„·','ã„¹','ã…Œ'].includes(onset)) scores[1] += 15;
        else if(['ã…‡','ã…'].includes(onset)) scores[2] += 15;
        else if(['ã……','ã…ˆ','ã…Š'].includes(onset)) scores[3] += 15;
        else if(['ã…','ã…‚','ã…'].includes(onset)) scores[4] += 15;

        session.scores = scores.map((s, i) => s + ( (session.seed + i) % 15 ));

        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-result').classList.remove('hidden');
        document.getElementById('res-id').innerText = `REF. #${session.seed}`;
        
        renderChart();
        switchTab('fortune', document.querySelector('.tab-btn'));
    }

    function getHangulOnset(char) {
        const charCode = char.charCodeAt(0) - 44032;
        if (charCode < 0 || charCode > 11171) return char; 
        return String.fromCharCode(Math.floor(charCode / 588) + 4352);
    }

    function renderChart() {
        const labels = ["æœ¨(ë‚˜ë¬´)", "ç«(ë¶ˆ)", "åœŸ(í™)", "é‡‘(ì‡ )", "æ°´(ë¬¼)"];
        const cx = 120, cy = 120, r = 85;
        let polyPoints = "";
        labels.forEach((l, i) => {
            const angle = (Math.PI * 2 / 5) * i - (Math.PI / 2);
            const value = (session.scores[i] / 100) * r;
            polyPoints += `${cx + value * Math.cos(angle)},${cy + value * Math.sin(angle)} `;
        });

        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const typeLabels = ["ê°•ì¸í•œ ë‚˜ë¬´", "ì •ì—´ì ì¸ ë¶ˆ", "ì¤‘ì‹¬ì„ ì§€í‚¤ëŠ” í™", "ì˜ˆë¦¬í•œ ê¸ˆì†", "ê¹Šê³  ë§‘ì€ ë¬¼"];
        document.getElementById('res-type').innerText = `[${typeLabels[maxIdx]}] ì˜ ê¸°ì§ˆ`;

        document.getElementById('radarChart').innerHTML = `
            <svg viewBox="0 0 240 240" style="overflow:visible;">
                <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="#F0F0F0" stroke-width="1" />
                <circle cx="${cx}" cy="${cy}" r="${r*0.6}" fill="none" stroke="#F0F0F0" stroke-width="1" />
                ${labels.map((l, i) => {
                    const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
                    return `<line x1="${cx}" y1="${cy}" x2="${cx + r * Math.cos(a)}" y2="${cx + r * Math.sin(a)}" stroke="#EEE" stroke-dasharray="2,2" />
                            <text x="${cx + (r+25) * Math.cos(a)}" y="${cx + (r+25) * Math.sin(a)}" text-anchor="middle" font-size="10" fill="#999" font-weight="600">${l}</text>`;
                }).join('')}
                <polygon points="${polyPoints}" fill="rgba(154, 132, 103, 0.3)" stroke="var(--accent)" stroke-width="2.5" />
            </svg>
        `;
    }

    function switchTab(mode, btn) {
        if(btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        const body = document.getElementById('tab-body');
        const s = session.seed;
        const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const minIdx = session.scores.indexOf(Math.min(...session.scores));

        if(mode === 'fortune') {
            const lackElement = elements[minIdx];
            const quotes = quoteData["ì¸ìƒ"];
            const q = quotes[s % quotes.length];
            body.innerHTML = `
                <span class="section-title">ì—ë„ˆì§€ ë³´ê°• ì§€ì¹¨</span>
                ${session.name}ë‹˜ì€ í˜„ì¬ <b>${elementAttributes[lackElement].name}</b>ì˜ ê¸°ìš´ì´ ë¶€ì¡±í•œ ìƒíƒœì…ë‹ˆë‹¤. <br><br>
                â€¢ <b>ë§ì¶¤ í–‰ë²•:</b> ${elementMissions[lackElement]}<br>
                â€¢ <b>ê¸¸í•œ ìƒ‰ìƒ:</b> ${elementAttributes[lackElement].color}<br>
                â€¢ <b>ì˜¤ëŠ˜ì˜ ì¡°ì–¸:</b> ${recommendations[s % recommendations.length]}
                <div class="quote-footer">"${q.text}"</div>
            `;
        } else if(mode === 'past') {
            const pastIdx = (maxIdx * 6) + (s % 6);
            const p = pastLifeData[pastIdx];
            body.innerHTML = `
                <span class="section-title">ì „ê±°(å‰å±…) ì—ë„ˆì§€ í”„ë¡œí•„</span>
                ê³¼ê±° <b>[${p.job}]</b>ì˜ ì†Œëª…ì„ ê¸°ë¡í•˜ê³  ìˆìŠµë‹ˆë‹¤. <br><br>
                - ${p.desc}<br><br>
                <b>í˜„ìƒì— ë‚¨ê²¨ì§„ ìˆ™ì œ:</b><br> " ${p.homework} "
            `;
        } else {
            const r = reincarnationData[s % reincarnationData.length];
            body.innerHTML = `
                <span class="section-title">ì°¨ê¸° ë‚´ì„¸ ì˜ˆì•½ í™•ì•½ì„œ</span>
                ë‹¤ìŒ ìƒìœ¼ë¡œì˜ ì—ë„ˆì§€ ì „ì´ ê²½ë¡œê°€ ê³µì‹ì ìœ¼ë¡œ í™•ì•½ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>
                â€¢ <b>ì°¨ê¸° ì •ì°©ì§€:</b> ${r.place}<br>
                â€¢ <b>ì¬íƒ„ìƒ í˜•íƒœ:</b> ${r.object}<br>
                â€¢ <b>í™•ì • ì¡°ê±´:</b> ${r.mission}
            `;
        }
    }

   function copyLink() {
        // í˜„ì¬ ì…ë ¥ëœ ì´ë¦„ê³¼ ìƒì¼ì„ ì£¼ì†Œ ë’¤ì— ë¶™ì—¬ì„œ ìƒˆë¡œìš´ ë§í¬ë¥¼ ë§Œë“­ë‹ˆë‹¤.
        const shareUrl = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(session.name)}&birth=${session.birth}`;
        const text = `[ìš´ëª… ê³µí•™ ë¦¬í¬íŠ¸] ${session.name}ë‹˜ì˜ ë¶„ì„ ê²°ê³¼ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤.\nì§ì ‘ í™•ì¸í•´ë³´ì„¸ìš”: ${shareUrl}`;
        
        const t = document.createElement("textarea");
        document.body.appendChild(t);
        t.value = text;
        t.select();
        document.execCommand("copy");
        document.body.removeChild(t);
        
        alert("ë‚˜ì˜ ë°ì´í„°ê°€ ë‹´ê¸´ ê³µìœ  ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ");
    }
</html>
