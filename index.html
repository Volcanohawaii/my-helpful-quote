<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destiny Lab</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        :root { --bg: #F0EDE9; --paper: #FFFFFF; --primary: #243447; --accent: #9A8467; --text: #444444; --border: #D1CDC5; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .container { width: 100%; max-width: 480px; position: relative; }
        .lang-toggle { position: absolute; top: -50px; right: 0; display: flex; gap: 15px; }
        .flag { font-size: 1.6rem; cursor: pointer; opacity: 0.4; filter: grayscale(100%); transition: 0.3s; }
        .flag.active { opacity: 1; filter: grayscale(0%); transform: scale(1.2); }
        .report-card { background: var(--paper); padding: 55px 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); border: 1px solid var(--border); text-align: center; position: relative; animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .official-seal { position: absolute; top: 25px; right: 25px; width: 65px; height: 65px; border: 2px double var(--accent); color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Gowun Batang', serif; font-size: 0.7rem; font-weight: 700; opacity: 0.5; transform: rotate(12deg); pointer-events: none; }
        h1 { font-family: 'Gowun Batang', serif; font-size: 1.5rem; color: var(--primary); margin: 0 0 10px 0; word-break: keep-all; }
        .summary-line { font-family: 'Gowun Batang', serif; font-size: 1rem; color: var(--accent); margin-bottom: 30px; font-weight: 600; }
        .tab-content { text-align: left; line-height: 1.9; font-size: 0.95rem; }
        .section-wrap { margin-bottom: 35px; }
        .section-title { font-family: 'Gowun Batang', serif; font-size: 1.05rem; color: var(--accent); display: block; margin-bottom: 15px; font-weight: 700; border-bottom: 1px solid #F0F0F0; padding-bottom: 8px; }
        .info-box { background: #F9F8F6; padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 15px; }
        .warning-box { background: #FFF5F5; padding: 18px; border-radius: 8px; font-size: 0.85rem; color: #C0392B; border: 1px dashed #FADBD8; margin-top: 25px; }
        .tabs { display: flex; border-bottom: 1px solid #EEE; margin: 30px 0; }
        .tab-btn { flex: 1; padding: 12px 0; border: none; background: none; cursor: pointer; font-size: 0.9rem; color: #BBB; font-family: 'Gowun Batang'; }
        .tab-btn.active { color: var(--primary); font-weight: 700; border-bottom: 2px solid var(--primary); }
        .btn-action { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 1rem; }
        .hidden { display: none; }
        input { width: 100%; padding: 15px; margin-bottom: 20px; border: none; border-bottom: 1px solid #DDD; font-size: 1.1rem; outline: none; }
    </style>
</head>
<body>
<div class="container">
    <div class="lang-toggle">
        <span class="flag active" id="flag-ko" onclick="setLang('ko')">ğŸ‡°ğŸ‡·</span>
        <span class="flag" id="flag-en" onclick="setLang('en')">ğŸ‡ºğŸ‡¸</span>
    </div>

    <div class="report-card" id="view-home">
        <div class="official-seal" id="seal-home">ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤</div>
        <h1 id="ui-title">ì„±ëª…í•™ ë°ì´í„° ë¶„ì„</h1>
        <p id="ui-desc" style="font-size:0.9rem; color:#888; margin-bottom:40px;">ì •ì‹ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
        <input type="text" id="userName" placeholder="Name">
        <input type="text" id="userBirth" placeholder="YYYYMMDD">
        <button class="btn-action" id="ui-btn" onclick="startAnalysis()">ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°</button>
    </div>

    <div class="report-card hidden" id="view-result">
        <div class="official-seal" id="seal-res">ì •ì‹ë¶„ì„ë³¸</div>
        <h1 id="dynamic-title">ë‹˜ì„ ìœ„í•œ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
        <div class="summary-line" id="dynamic-summary">ë¶„ì„ ì¤‘...</div>
        <div id="radarChart" style="margin:0 auto 30px; width:220px; height:220px;"></div>
        <div class="tabs">
            <button class="tab-btn active" id="tab1" onclick="switchTab('fortune', this)">í˜„ìƒ ë¶„ì„</button>
            <button class="tab-btn" id="tab2" onclick="switchTab('past', this)">ì „ìƒ ê¸°ë¡</button>
            <button class="tab-btn" id="tab3" onclick="switchTab('next', this)">ë‚´ì„¸ ì˜ˆì•½</button>
        </div>
        <div class="tab-content" id="tab-body"></div>
        <button class="btn-action" style="margin-top:40px; background:white; border:1px solid #DDD; color:#444;" id="ui-copy" onclick="copyLink()">ë§í¬ ë³µì‚¬</button>
        <p onclick="window.location.href=window.location.pathname" style="font-size:0.7rem; color:#CCC; margin-top:20px; cursor:pointer;" id="ui-reset">ì´ˆê¸°í™”</p>
    </div>
</div>

<script src="quotes.js"></script>
<script>
    let currentLang = 'ko';
    let session = { name: '', birth: '', seed: 0, scores: [], nameReport: '' };

    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
        document.getElementById(`flag-${lang}`).classList.add('active');
        const t = i18n[lang];
        document.getElementById('ui-title').innerText = t.title;
        document.getElementById('ui-desc').innerText = t.desc;
        document.getElementById('userName').placeholder = t.nameLabel;
        document.getElementById('userBirth').placeholder = t.birthLabel;
        document.getElementById('ui-btn').innerText = t.btn;
        document.getElementById('ui-reset').innerText = t.reset;
        document.getElementById('seal-home').innerHTML = lang === 'ko' ? "ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤" : "Destiny<br>Lab";
        document.getElementById('seal-res').innerText = lang === 'ko' ? "ì •ì‹ë¶„ì„ë³¸" : "OFFICIAL";
        if (session.name) processData(session.name, session.birth);
    }

    function startAnalysis() {
        const n = document.getElementById('userName').value.trim();
        const b = document.getElementById('userBirth').value.trim();
        if(!n || b.length !== 8) { alert(currentLang === 'ko' ? "ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”." : "Check inputs."); return; }
        processData(n, b);
    }

    function processData(name, birth) {
        session.name = name; session.birth = birth;
        session.seed = name.split('').reduce((a,b)=>a+b.charCodeAt(0),0) + parseInt(birth);
        let scores = [40, 40, 40, 40, 40]; 
        for(let i=0; i<name.length; i++) {
            let el = /[a-zA-Z]/.test(name[i]) ? alphabetElements[name[i].toUpperCase()] : hangulElements[getHangulOnset(name[i])];
            if(el) scores[["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"].indexOf(el)] += 35;
        }
        const month = parseInt(birth.substring(4, 6));
        scores[[11,12,1,2,3,4,5,6,7,8,9,10].indexOf(month) % 5] += 25;
        session.scores = scores.map((s, i) => s + ((session.seed + i) % 15));

        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
        document.getElementById('dynamic-title').innerText = currentLang === 'ko' ? `[${name}]ë‹˜ì˜ ìš´ëª… ê³µí•™ ë¦¬í¬íŠ¸` : `Destiny Report for [${name}]`;
        document.getElementById('dynamic-summary').innerText = currentLang === 'ko' ? nicknamesKo[elements[maxIdx]] : nicknamesEn[elements[maxIdx]];

        const res = nameNumerology[(session.seed % 25) + 1] || nameNumerology[1];
        session.nameReport = currentLang === 'ko' ? `ì„±ëª…í•™ì ìœ¼ë¡œ <b>${res.title}</b>ì´ë©°, ${res.desc}` : `Numerologically, you hold <b>${res.titleEn}</b>: ${res.descEn}`;

        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-result').classList.remove('hidden');
        renderChart();
        switchTab('fortune', document.getElementById('tab1'));
    }

    function getHangulOnset(char) {
        const c = char.charCodeAt(0) - 44032;
        if (c < 0 || c > 11171) return null;
        return ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'][Math.floor(c / 588)];
    }

    function renderChart() {
        const labels = currentLang === 'ko' ? ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"] : ["Wood", "Fire", "Earth", "Metal", "Water"];
        const cx = 110, cy = 110, r = 80;
        let poly = "";
        labels.forEach(() => poly += `${cx},${cy} `);
        document.getElementById('radarChart').innerHTML = `<svg viewBox="0 0 220 220"><circle cx="110" cy="110" r="80" fill="none" stroke="#EEE"/><polygon points="${poly}" fill="rgba(154, 132, 103, 0.3)" stroke="#9A8467" stroke-width="2"><animate attributeName="points" dur="1s" fill="freeze" to="${getTargetPoints(labels, cx, cy, r)}" /></polygon></svg>`;
    }

    function getTargetPoints(labels, cx, cy, r) {
        let p = "";
        labels.forEach((l, i) => {
            const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
            const v = (session.scores[i] / 150) * r;
            p += `${cx + v * Math.cos(a)},${cy + v * Math.sin(a)} `;
        });
        return p;
    }

    function switchTab(mode, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active');
        const body = document.getElementById('tab-body'); const s = session.seed;
        const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
        const getLevel = (sc) => sc >= 75 ? 'strong' : (sc >= 45 ? 'normal' : 'weak');
        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const minIdx = session.scores.indexOf(Math.min(...session.scores));

        const t = i18n[currentLang];
        const presSource = currentLang === 'ko' ? elementPrescriptions : enPrescriptions;
        const attrSource = currentLang === 'ko' ? elementAttributesKo : elementAttributesEn;
        const pastSource = currentLang === 'ko' ? pastLifeData : pastLifeDataEn;
        const nextSource = currentLang === 'ko' ? reincarnationData : reincarnationDataEn;
        const sideSource = currentLang === 'ko' ? sideEffects : sideEffectsEn;
        const quoteSource = currentLang === 'ko' ? quoteData["ì¸ìƒ"] : quoteDataEn["life"];

        if(mode === 'fortune') {
            const strongEl = elements[maxIdx]; const lackEl = elements[minIdx];
            body.innerHTML = `
                <div class="section-wrap"><span class="section-title">${t.sec1}</span><div class="info-box">${session.nameReport}</div></div>
                <div class="section-wrap"><span class="section-title">${t.sec2} [${attrSource[strongEl].name}]</span><div><b>${currentLang === 'ko' ? 'ì„±í–¥' : 'Trait'}:</b> ${attrSource[strongEl].trait}</div><div class="detail-item">â€¢ <b>${t.advise}:</b> ${presSource[strongEl][getLevel(session.scores[maxIdx])]}</div></div>
                <div class="section-wrap"><span class="section-title">${t.sec3} [${attrSource[lackEl].name}]</span><div>â€¢ <b>${t.practice}:</b> ${presSource[lackEl][getLevel(session.scores[minIdx])]}</div></div>
                <div class="warning-box"><b>âš ï¸ ${t.sideEffect}</b><br>${sideSource[s % sideSource.length]}</div>
                <div style="margin-top:30px; text-align:center; color:#AAA; font-style:italic;">"${quoteSource[s % quoteSource.length].text}"</div>
            `;
        } else if(mode === 'past') {
            const p = pastSource[s % pastSource.length];
            // [ìµœì¢… ìˆ˜ì •] ê³¼ê±°ì˜ ì†Œëª…ê³¼ í˜„ìƒì˜ ìˆ™ì œë¥¼ í•˜ë‚˜ì˜ info-box ì•ˆìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì •ë ¬
            body.innerHTML = `
                <span class="section-title">${t.tab2}</span>
                <div class="info-box" style="line-height:1.8;">
                    <div style="margin-bottom:10px;"><b>${t.pastJob}:</b> [${p.job}]</div>
                    <div style="font-size:0.9rem; color:#666; margin-bottom:15px;">${p.desc}</div>
                    <div style="border-top:1px dashed #DDD; padding-top:10px;"><b>âœ¨ ${t.pastHomework}:</b><br>" ${p.homework} "</div>
                </div>
            `;
        } else {
            const r = nextSource[s % nextSource.length];
            // [ìµœì¢… ìˆ˜ì •] ì°¨ê¸° ì •ì°©ì§€, ì¬íƒ„ìƒ í˜•íƒœ, í™•ì • ì¡°ê±´ì„ í•˜ë‚˜ì˜ info-box ì•ˆìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì •ë ¬
            body.innerHTML = `
                <span class="section-title">${t.tab3}</span>
                <div class="info-box" style="line-height:2.2;">
                    <div><b>ğŸ“ ${t.nextDest}:</b> ${r.place}</div>
                    <div><b>ğŸ§¬ ${t.nextObj}:</b> ${r.object}</div>
                    <div style="border-top:1px dashed #DDD; padding-top:10px; margin-top:10px;"><b>âœ… ${t.nextMission}:</b> ${r.mission}</div>
                </div>
            `;
        }
    }

    function copyLink() {
        const url = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(session.name)}&birth=${session.birth}&lang=${currentLang}`;
        const t = document.createElement("textarea"); document.body.appendChild(t); t.value = `[Destiny Report] ${session.name}\n${url}`; t.select(); document.execCommand("copy"); document.body.removeChild(t);
        alert(currentLang === 'ko' ? "ë³µì‚¬ ì™„ë£Œ!" : "Link Copied!");
    }

    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('lang')) setLang(urlParams.get('lang'));
        const n = urlParams.get('name'); const b = urlParams.get('birth');
        if (n && b && b.length === 8) processData(n, b);
    };
</script>
</body>
</html>
