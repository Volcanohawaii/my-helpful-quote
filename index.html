<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destiny Lab</title>
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://t1.daumcdn.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data: https://api.countapi.xyz; frame-src https://t1.daumcdn.net https://display.adfit.kakao.com; connect-src https://api.countapi.xyz;">

    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        :root { --bg: #F0EDE9; --paper: #FFFFFF; --primary: #243447; --accent: #9A8467; --text: #444444; --border: #D1CDC5; }
        
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; overflow-x: hidden; position: relative; }

        /* ë°°ê²½ ë³„ê°€ë£¨ íš¨ê³¼ */
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;
            background-image: radial-gradient(circle at center, rgba(255, 255, 255, 0.9) 0.5px, transparent 1.2px), radial-gradient(circle at center, rgba(154, 132, 103, 0.4) 1px, transparent 2px);
            background-size: 50px 50px, 100px 100px; background-position: 0 0, 30px 30px; opacity: 0.4; animation: twinkle 5s ease-in-out infinite alternate;
        }
        @keyframes twinkle { 0% { opacity: 0.2; transform: translateY(0); } 100% { opacity: 0.6; transform: translateY(-8px); } }

        .container { width: 100%; max-width: 480px; position: relative; z-index: 1; }
        .lang-toggle { position: absolute; top: -50px; right: 0; display: flex; gap: 15px; }
        .flag { font-size: 1.6rem; cursor: pointer; opacity: 0.4; filter: grayscale(100%); transition: 0.3s; }
        .flag.active { opacity: 1; filter: grayscale(0%); transform: scale(1.2); }
        .report-card { background: var(--paper); padding: 55px 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); border: 1px solid var(--border); text-align: center; position: relative; animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .official-seal { position: absolute; top: 25px; right: 25px; width: 65px; height: 65px; border: 2px double var(--accent); color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Gowun Batang', serif; font-size: 0.7rem; font-weight: 700; opacity: 0.5; transform: rotate(12deg); pointer-events: none; }
        
        h1 { font-family: 'Gowun Batang', serif; font-size: 1.5rem; color: var(--primary); margin: 0 0 10px 0; word-break: keep-all; }
        .summary-line { font-family: 'Gowun Batang', serif; font-size: 1rem; color: var(--accent); margin-bottom: 30px; font-weight: 600; }
        .tab-content { text-align: left; line-height: 1.9; font-size: 0.95rem; }
        .section-wrap { margin-bottom: 35px; }
        .section-title { font-family: 'Gowun Batang', serif; font-size: 1.05rem; color: var(--accent); display: block; margin-bottom: 15px; font-weight: 700; border-bottom: 1px solid #F0F0F0; padding-bottom: 8px; }
        .info-box { background: #F9F8F6; padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 15px; }
        .warning-box { background: #FFF5F5; padding: 18px; border-radius: 8px; font-size: 0.85rem; color: #C0392B; border: 1px dashed #FADBD8; margin-top: 25px; }
        .tabs { display: flex; border-bottom: 1px solid #EEE; margin: 30px 0; }
        .tab-btn { flex: 1; padding: 12px 0; border: none; background: none; cursor: pointer; font-size: 0.9rem; color: #BBB; font-family: 'Gowun Batang'; }
        .tab-btn.active { color: var(--primary); font-weight: 700; border-bottom: 2px solid var(--primary); }
        .btn-action { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 1rem; }
        .hidden { display: none; }
        input { width: 100%; padding: 15px; margin-bottom: 20px; border: none; border-bottom: 1px solid #DDD; font-size: 1.1rem; outline: none; }
        
        .visitor-counter { margin-top: 25px; font-size: 0.75rem; color: #AAA; font-family: 'Gowun Batang'; border-top: 1px solid #F5F5F5; padding-top: 15px; }
        .visitor-count-num { color: var(--accent); font-weight: 700; transition: all 1s; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

<div id="loading-overlay" style="position:fixed; inset:0; width:100%; height:100dvh; background:rgba(240, 237, 233, 0.96); z-index:9999; display:none; align-items:center; justify-content:center; padding:20px; backdrop-filter: blur(2px);">
    <div style="background:white; padding:40px 15px; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.05); border:1px solid #D1CDC5; width:100%; max-width:340px; min-width:320px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-sizing:border-box;">
        <div id="load-seal" class="official-seal" style="position:static; margin-bottom:20px; opacity:1;">ë¶„ì„ì¤‘</div>
        <h2 id="load-title" style="font-family:'Gowun Batang'; color:var(--primary); font-size:1.1rem; margin-bottom:8px; width:100%; text-align:center;">ìš´ëª…ì˜ ì—ë„ˆì§€ë¥¼ ì¡°í•© ì¤‘...</h2>
        <p id="load-desc" style="color:#888; font-size:0.8rem; margin-bottom:25px; width:100%; text-align:center;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
        <div style="width:300px; height:250px; background:#f9f9f9; display:flex; align-items:center; justify-content:center; border-radius:8px; overflow:hidden; flex-shrink:0;">
            <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-pMoVBneQCSicnBZ7" data-ad-width = "300" data-ad-height = "250"></ins>
            <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        </div>
        <div style="margin-top:25px; border:3px solid #f3f3f3; border-top:3px solid var(--accent); border-radius:50%; width:24px; height:24px; animation:spin 1s linear infinite;"></div>
    </div>
</div>

<div class="container">
    <div class="lang-toggle">
        <span class="flag active" id="flag-ko" onclick="setLang('ko')">ğŸ‡°ğŸ‡·</span>
        <span class="flag" id="flag-en" onclick="setLang('en')">ğŸ‡ºğŸ‡¸</span>
    </div>

    <div class="report-card" id="view-home">
        <div class="official-seal" id="seal-home">ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤</div>
        <h1 id="ui-title">ì„±ëª…í•™ ë°ì´í„° ë¶„ì„</h1>
        <p id="ui-desc" style="font-size:0.85rem; color:#888; margin-bottom:40px; line-height:1.6; word-break:keep-all; padding:0 10px;">ì´ë¦„ì˜ íŒŒë™ ì—ë„ˆì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ì£¼ì˜ ê³„ì ˆì  ìš”ì¸ì„ ê²°í•©í•˜ì—¬ ê³ ìœ í•œ ìš´ëª… ê¸°ìš´ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>
        
        <input type="text" id="userName" placeholder="ì„±í•¨">
        <input type="text" id="userBirth" placeholder="ì–‘ë ¥ ìƒë…„ì›”ì¼ 8ìë¦¬" onkeyup="if(event.key==='Enter'){startAnalysis()}">
        <button class="btn-action" id="ui-btn" onclick="startAnalysis()">ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°</button>

        <div class="visitor-counter" id="visitor-ui">
            ì§€ê¸ˆê¹Œì§€ <span class="visitor-count-num" id="visit-count">...</span>ëª…ì´ ë¶„ì„ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.
        </div>

        <div style="margin-top: 30px; display: flex; justify-content: center;">
            <ins class="kakao_ad_area" style="display:none;" data-ad-unit = "DAN-gySJpKsnNTQ1FIIF" data-ad-width = "320" data-ad-height = "50"></ins>
            <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        </div> 
    </div>

    <div class="report-card hidden" id="view-result">
        <div class="official-seal" id="seal-res">ì •ì‹ë¶„ì„ë³¸</div>
        <h1 id="dynamic-title">ë‹˜ì„ ìœ„í•œ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
        <div id="radarChart" style="margin:0 auto 20px; width:220px; height:220px;"></div>
        <div class="summary-line" id="dynamic-summary" style="margin-top: 10px;">ë¶„ì„ ì¤‘...</div>

        <div class="tabs">
            <button class="tab-btn active" id="tab1" onclick="switchTab('fortune', this)">í˜„ìƒ ë¶„ì„</button>
            <button class="tab-btn" id="tab2" onclick="switchTab('past', this)">ì „ìƒ ê¸°ë¡</button>
            <button class="tab-btn" id="tab3" onclick="switchTab('next', this)">ë‚´ì„¸ ì˜ˆì•½</button>
        </div>
        <div class="tab-content" id="tab-body"></div>

        <button class="btn-action" style="margin-top:30px; background:white; border:1px solid #DDD; color:#444;" id="ui-copy" onclick="copyLink()">ë§í¬ ë³µì‚¬</button>
        <p onclick="window.location.href=window.location.pathname" style="font-size:0.7rem; color:#CCC; margin-top:20px; cursor:pointer;" id="ui-reset">ì´ˆê¸°í™”</p>
    </div>
</div>

<script src="quotes.js"></script>
<script>
    const i18n = {
        ko: {
            title: "ì„±ëª…í•™ ë°ì´í„° ë¶„ì„",
            desc: "ì´ë¦„ì˜ íŒŒë™ ì—ë„ˆì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ì£¼ì˜ ê³„ì ˆì  ìš”ì¸ì„ ê²°í•©í•˜ì—¬ ê³ ìœ í•œ ìš´ëª… ê¸°ìš´ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.",
            nameLabel: "ì„±í•¨", birthLabel: "ì–‘ë ¥ ìƒë…„ì›”ì¼ 8ìë¦¬", btn: "ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°",
            reset: "ì´ˆê¸°í™”", tab1: "í˜„ìƒ ë¶„ì„", tab2: "ì „ìƒ ê¸°ë¡", tab3: "ë‚´ì„¸ ì˜ˆì•½", copy: "ë§í¬ ë³µì‚¬",
            sec1: "[ì„±ëª…í•™ì  í˜„ìƒ ë¶„ì„]", sec2: "[ê°•ì  ì˜¤í–‰ì˜ ê¸°ìš´]", sec3: "[ë¶€ì¡± ì˜¤í–‰ì˜ ë³´ì™„]",
            advise: "ìš´ëª…ì  ì¡°ì–¸", practice: "ê°œìš´ë²• ì‹¤ì²œ", sideEffect: "ê³¼ìœ ë¶ˆê¸‰ ì£¼ì˜"
        },
        en: {
            title: "Destiny Data Analysis",
            desc: "Extracts unique destiny energy by combining name vibrations with seasonal Saju factors.",
            nameLabel: "Full Name", birthLabel: "Birthdate (YYYYMMDD)", btn: "Generate Report",
            reset: "Reset", tab1: "Present Life", tab2: "Past Life", tab3: "Next Life", copy: "Copy Link",
            sec1: "[Numerological Analysis]", sec2: "[Dominant Energy]", sec3: "[Lacking Energy]",
            advise: "Destiny Advice", practice: "How to Improve", sideEffect: "Warning"
        }
    };

    let currentLang = 'ko';
    let session = { name: '', birth: '', seed: 0, scores: [], nameReport: '' };

    /* 5ë‹¨ê³„ í™•ì¥ ì²˜ë°© */
    const elementPrescriptions = {
        "æœ¨": { veryStrong: "ê¸°ìš´ì´ ê³¼í•´ ë…ë‹¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª…ìƒì´ í•„ìš”í•©ë‹ˆë‹¤.", strong: "ì¶”ì§„ë ¥ì´ ì¢‹ìŠµë‹ˆë‹¤. ê³„íší•œ ì¼ì„ ë§ˆë¬´ë¦¬í•˜ëŠ” ìŠµê´€ì„ ë“¤ì´ì„¸ìš”.", normal: "ì•ˆì •ì ì…ë‹ˆë‹¤. ì‹ë¬¼ì„ ëŒë³´ë©° ë¦¬ë“¬ì„ ìœ ì§€í•˜ì‹­ì‹œì˜¤.", weak: "ì˜ìš•ì€ ìˆìœ¼ë‚˜ ë’·ì‹¬ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì•„ì¹¨ ì‚°ì±…ì´ ê¸¸í•©ë‹ˆë‹¤.", veryWeak: "ìƒê¸°ê°€ ê³ ê°ˆëœ ìƒíƒœì…ë‹ˆë‹¤. ì‹ ë§› ìŒì‹ì´ë‚˜ ì´ˆë¡ìƒ‰ ì˜·ì„ ì¶”ì²œí•©ë‹ˆë‹¤." },
        "ç«": { veryStrong: "ê°ì • ê¸°ë³µì´ ì‹¬í•˜ê³  ë²ˆì•„ì›ƒ ì£¼ì˜. ìš´ë™ìœ¼ë¡œ ì—´ì„ ì‹íˆì„¸ìš”.", strong: "ì—´ì •ì´ ë„˜ì¹©ë‹ˆë‹¤. ê·¸ ì—ë„ˆì§€ë¥¼ ì‚¬ëŒë“¤ê³¼ ë‚˜ëˆ„ë©´ ë³µì´ ì˜µë‹ˆë‹¤.", normal: "ì•ˆì •ì ì…ë‹ˆë‹¤. ì˜ˆì˜ë¥¼ ê°–ì¶˜ íƒœë„ê°€ ìš´ì„ ë” ë†’ì—¬ì¤ë‹ˆë‹¤.", weak: "ì˜ìš•ì´ ì €í•˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚®ì— í–‡ë³•ì„ 20ë¶„ ì´ìƒ ì¬ì‹­ì‹œì˜¤.", veryWeak: "ë¬´ê¸°ë ¥í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤. ì“´ë§›ì˜ ì°¨ë¥¼ ë§ˆì‹œê³  ë¶‰ì€ìƒ‰ì„ ê°€ê¹Œì´í•˜ì„¸ìš”." },
        "åœŸ": { veryStrong: "ê³ ì§‘ì´ ì„¸ì§€ê³  ìƒê°ì´ ì •ì²´ë˜ê¸° ì‰½ìŠµë‹ˆë‹¤. í™˜ê²½ì„ ë°”ê¿”ë³´ì„¸ìš”.", strong: "í¬ìš©ë ¥ì´ í›Œë¥­í•©ë‹ˆë‹¤. ë‚¨ì˜ ë§ì„ ì˜ ë“¤ì–´ì£¼ë©´ ìš´ì´ ì—´ë¦½ë‹ˆë‹¤.", normal: "ì•ˆì •ê°ì´ í›Œë¥­í•©ë‹ˆë‹¤. ë…ì„œí•˜ë©° ë‚´ì‹¤ì„ ë‹¤ì§€ê¸°ì— ì¢‹ì€ ë•Œì…ë‹ˆë‹¤.", weak: "ê¸°ë°˜ì´ í”ë“¤ë¦½ë‹ˆë‹¤. ë§¨ë°œë¡œ í™ì„ ë°Ÿì•„ ëŒ€ì§€ì˜ ê¸°ìš´ì„ ë°›ìœ¼ì„¸ìš”.", veryWeak: "ìì‹ ê°ì´ ë¶€ì¡±í•œ ìƒíƒœ. ë‹¬ì½¤í•œ ê°„ì‹ì„ ì±™ê¸°ê³  ì‚°í–‰ì„ ì¶”ì²œí•©ë‹ˆë‹¤." },
        "é‡‘": { veryStrong: "íŒë‹¨ì´ ë‚ ì¹´ë¡œì›Œ ì£¼ë³€ì„ ë‹¤ì¹˜ê²Œ í•©ë‹ˆë‹¤. í´ë˜ì‹ì„ ë“¤ìœ¼ì„¸ìš”.", strong: "ê²°ë‹¨ë ¥ì´ ë‚ ì¹´ë¡­ìŠµë‹ˆë‹¤. ì •ë¦¬ì— ì•„ì£¼ ìµœì ì¸ ì‹œê¸°ì…ë‹ˆë‹¤.", normal: "ì´ì„±ì ì´ê³  ê¹”ë”í•©ë‹ˆë‹¤. ê·œì¹™ì ì¸ ìƒí™œì´ ê°€ì¥ í° ë¬´ê¸°ì…ë‹ˆë‹¤.", weak: "ìš°ìœ ë¶€ë‹¨í•´ì§€ê¸° ì‰½ìŠµë‹ˆë‹¤. ê¸ˆì† ì¥ì‹ êµ¬ë¥¼ ì°©ìš©í•´ ë³´ê°•í•˜ì„¸ìš”.", veryWeak: "ë§ºê³  ëŠìŒì´ ì•ˆ ë˜ì–´ ì†í•´ë¥¼ ë´…ë‹ˆë‹¤. í°ìƒ‰ ì˜·ê³¼ ë§¤ìš´ ë§›ì´ ê¸¸í•©ë‹ˆë‹¤." },
        "æ°´": { veryStrong: "ìƒê°ì´ ë„ˆë¬´ ë§ì•„ ìš°ìš¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë•€ í˜ë ¤ ìš´ë™í•˜ì„¸ìš”.", strong: "ì§€í˜œê°€ ìƒ˜ì†ŸìŠµë‹ˆë‹¤. ì°½ì‘ í™œë™ì´ë‚˜ í•™ìŠµì„ ì‹œì‘í•˜ê¸°ì— ì¢‹ìŠµë‹ˆë‹¤.", normal: "ìœ ì—°í•˜ê³  ì—¬ìœ ë¡­ìŠµë‹ˆë‹¤. ìˆœë¦¬ëŒ€ë¡œ íë¥´ë©´ ë§Œì‚¬ê°€ í‰ì•ˆí•©ë‹ˆë‹¤.", weak: "ìœµí†µì„±ì´ ë¶€ì¡±í•´ì§‘ë‹ˆë‹¤. ë”°ëœ»í•œ ì°¨ë¡œ ìˆœí™˜ì„ ì ê·¹ ë„ìš°ì‹­ì‹œì˜¤.", veryWeak: "ì—ë„ˆì§€ê°€ ê³ ê°ˆë˜ì—ˆìŠµë‹ˆë‹¤. ì§ ë§› ìŒì‹ê³¼ ê²€ì€ìƒ‰ ê³„ì—´ì´ ì¢‹ìŠµë‹ˆë‹¤." }
    };
    const enPrescriptions = {
        "æœ¨": { veryStrong: "Over-driven. Practice letting go.", strong: "Great momentum! Finish your goals.", normal: "Steady potential. Connect with nature.", weak: "Lacking drive. Boost it with sunlight.", veryWeak: "Depleted. Wear green or eat sour foods." },
        "ç«": { veryStrong: "High burnout risk. Release heat via exercise.", strong: "Radiant passion! Inspire others.", normal: "Bright energy. Politeness attracts luck.", weak: "Unmotivated. Get 20 min of sun daily.", veryWeak: "Exhausted. Carry red items and bitter tea." },
        "åœŸ": { veryStrong: "Feeling stuck? Change your scenery.", strong: "Great empathy! Helping others opens doors.", normal: "Reliable anchor. Great time for reading.", weak: "Ungrounded. Spend time in the garden.", veryWeak: "Low confidence. Try something sweet." },
        "é‡‘": { veryStrong: "Too critical. Soften with gentle music.", strong: "Sharp focus! Time to declutter.", normal: "Logical and organized. Keep your routine.", weak: "Indecisive. Wear gold or metal jewelry.", veryWeak: "Weak boundaries. Wear white items." },
        "æ°´": { veryStrong: "Overthinking. Move to break the slump.", strong: "Flowing wisdom! Perfect for learning.", normal: "Calm and flexible. Trust the flow.", weak: "Rigid flow. Drink warm tea daily.", veryWeak: "Mentally drained. Try salty flavors." }
    };

    const nicknamesKo = {
        "æœ¨": { veryStrong: "ìˆ²ì„ ì‚¼í‚¤ê³  ë²ˆì˜í•˜ëŠ” [ê±°ì¹¨ì—†ëŠ” ê°œì²™ì]", strong: "í•˜ëŠ˜ì„ í–¥í•´ ë»—ì–´ë‚˜ê°€ëŠ” [í‘¸ë¥¸ ìˆ²ì˜ ìœ„ëŒ€í•œ ê¸°íšì]", normal: "ì¡°í™”ë¡­ê²Œ ë¿Œë¦¬ ë‚´ë¦° [ìƒëª…ë ¥ ë„˜ì¹˜ëŠ” ì¤‘ì¬ì]", weak: "í–‡ì‚´ì„ ê¸°ë‹¤ë¦¬ë©° ìë¼ë‚˜ëŠ” [ê¿ˆê¾¸ëŠ” ì–´ë¦° ì‹¹]", veryWeak: "ë¹„ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë©”ë§ˆë¥¸ ëŒ€ì§€ì˜ [ê³ ë…í•œ ë‚˜ë­‡ê°€ì§€]" },
        "ç«": { veryStrong: "ëª¨ë“  ê²ƒì„ íƒœì›Œë²„ë¦´ ë“¯í•œ [í­ì£¼í•˜ëŠ” íƒœì–‘ì˜ í™”ì‹ ]", strong: "ì–´ë‘ ì„ ëª°ì•„ë‚´ê³  ì„¸ìƒì„ ë°íˆëŠ” [íƒœì–‘ì˜ ì—´ì • ë¦¬ë”]", normal: "ì£¼ë³€ì„ ë”°ëœ»í•˜ê²Œ ê°ì‹¸ëŠ” [ì˜¨í™”í•œ ë“±ë¶ˆì˜ ìˆ˜í˜¸ì]", weak: "ì€ì€í•˜ê²Œ ë¹›ì„ ë°œí•˜ëŠ” [ìƒˆë²½ë…˜ì˜ ì‘ì€ ë³„ë¹›]", veryWeak: "ë‹¤ì‹œ í”¼ì–´ë‚  ì¤€ë¹„ë¥¼ í•˜ëŠ” [ì¬ ì†ì˜ ë”°ëœ»í•œ ì˜¨ê¸°]" },
        "åœŸ": { veryStrong: "ì„¸ìƒì„ ì›€ì§ì´ì§€ ëª»í•˜ê²Œ ë§Œë“œëŠ” [ê±°ëŒ€í•œ ë°”ìœ„ì‚°]", strong: "ëª¨ë“  ìƒëª…ì„ í’ˆê³  ê¸¸ëŸ¬ë‚´ëŠ” [í™©ê¸ˆë¹› ëŒ€ì§€ì˜ ìˆ˜í˜¸ì]", normal: "ê· í˜•ì„ ì¡ì•„ì£¼ëŠ” [í‰í™”ë¡œìš´ ë“¤íŒì˜ ê´€ë¦¬ì]", weak: "ë³€í™”ì— ë¯¼ê°í•˜ê²Œ ë°˜ì‘í•˜ëŠ” [ë¶€ë“œìš´ ëª¨ë˜ ì–¸ë•]", veryWeak: "ë°”ëŒì— í©ë‚ ë¦¬ë©° ììœ ë¥¼ ì°¾ëŠ” [ë¨¼ì§€ ì†ì˜ ì •ë ¹]" },
        "é‡‘": { veryStrong: "ì°¨ê°‘ê³  ë‚ ì¹´ë¡œìš´ [ì ˆëŒ€ ê¶Œìœ„ì˜ ì‹¬íŒì]", strong: "ííŠ¸ëŸ¬ì§ ì—†ëŠ” ì •ì˜ë¥¼ ìˆ˜í˜¸í•˜ëŠ” [ì€ë¹› ì‹ ë…ì˜ ê²€ê°]", normal: "ì •êµí•˜ê²Œ ë‹¤ë“¬ì–´ì§„ [ì„¸ë ¨ëœ ì§€ì„±ì˜ ì¡°ê°ê°€]", weak: "ìœ ì—°í•¨ì„ ê°„ì§í•œ [ë¶€ë“œëŸ¬ìš´ í™©ê¸ˆì˜ ì„¸ê³µì‚¬]", veryWeak: "ì„¸ìƒì— ë™í™”ë˜ì–´ ë¬´ëŒì§„ [ì†Œë°•í•œ ë¬´ëª…ì˜ ì² í•™ì]" },
        "æ°´": { veryStrong: "ì‚¼ë¼ë§Œìƒì„ ì§‘ì–´ì‚¼í‚¤ëŠ” [ì‹¬ì—°ì˜ ê±°ëŒ€í•œ ì†Œìš©ëŒì´]", strong: "ê¹Šì€ ì‹¬ì—° ì†ì—ì„œ ì§„ë¦¬ë¥¼ ì°¾ëŠ” [ì§€í˜œë¡œìš´ ë°”ë‹¤ì˜ í•­í•´ì‚¬]", normal: "ë§‰í˜ì—†ì´ íë¥´ëŠ” [ë§‘ê³  ì˜ë¦¬í•œ ê³„ê³¡ì˜ ì‹œëƒ‡ë¬¼]", weak: "ì•„ì¹¨ ì´ìŠ¬ì²˜ëŸ¼ ì„¬ì„¸í•œ [ê°ì„±ì˜ ì˜ˆìˆ ê°€]", veryWeak: "í•œ ë°©ìš¸ì˜ ë¬¼ì— ìš°ì£¼ë¥¼ ë‹´ì€ [ëª…ìƒí•˜ëŠ” ê³ ìš”í•œ ì—°ëª»]" }
    };
    const nicknamesEn = {
        "æœ¨": { veryStrong: "Unstoppable Pioneer", strong: "Grand Architect", normal: "Vibrant Mediator", weak: "Dreaming Sprout", veryWeak: "Lonely Branch" },
        "ç«": { veryStrong: "Explosive Sun", strong: "Solar Leader", normal: "Warm Guardian", weak: "Subtle Starlight", veryWeak: "Hidden Ember" },
        "åœŸ": { veryStrong: "Immovable Mountain", strong: "Golden Guardian", normal: "Peaceful Manager", weak: "Soft Dune", veryWeak: "Spirit of Dust" },
        "é‡‘": { veryStrong: "Absolute Judge", strong: "Knight of Integrity", normal: "Refined Sculptor", weak: "Flexible Goldsmith", veryWeak: "Humble Philosopher" },
        "æ°´": { veryStrong: "Great Vortex", strong: "Wise Navigator", normal: "Clear Stream", weak: "Sensitive Artist", veryWeak: "Silent Pond" }
    };

    const elementColors = { "æœ¨": { fill: "rgba(46, 204, 113, 0.3)", stroke: "#27ae60" }, "ç«": { fill: "rgba(231, 76, 60, 0.3)", stroke: "#c0392b" }, "åœŸ": { fill: "rgba(241, 196, 15, 0.3)", stroke: "#f39c12" }, "é‡‘": { fill: "rgba(149, 165, 166, 0.3)", stroke: "#7f8c8d" }, "æ°´": { fill: "rgba(52, 152, 219, 0.3)", stroke: "#2980b9" } };

    function getLevel(sc) {
        if (sc >= 110) return 'veryStrong';
        if (sc >= 80) return 'strong';
        if (sc >= 50) return 'normal';
        if (sc >= 20) return 'weak';
        return 'veryWeak';
    }

    async function updateCounter() {
        try {
            const res = await fetch('https://api.countapi.xyz/hit/destinylab.github.io/visits');
            const data = await res.json();
            animateValue("visit-count", 0, data.value, 2000);
        } catch (e) { document.getElementById('visit-count').innerText = "1,245"; }
    }

    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        const range = end - start;
        const startTime = new Date().getTime();
        const timer = setInterval(() => {
            const now = new Date().getTime();
            const progress = Math.min((now - startTime) / duration, 1);
            obj.innerText = Math.floor(progress * range + start).toLocaleString();
            if (progress === 1) clearInterval(timer);
        }, 30);
    }

    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
        document.getElementById(`flag-${lang}`).classList.add('active');
        const t = i18n[lang];
        document.getElementById('ui-title').innerText = t.title;
        document.getElementById('ui-desc').innerText = t.desc;
        document.getElementById('userName').placeholder = t.nameLabel;
        document.getElementById('userBirth').placeholder = t.birthLabel;
        document.getElementById('ui-btn').innerText = t.btn;
        document.getElementById('ui-reset').innerText = t.reset;
        document.getElementById('tab1').innerText = t.tab1;
        document.getElementById('tab2').innerText = t.tab2;
        document.getElementById('tab3').innerText = t.tab3;
        document.getElementById('ui-copy').innerText = t.copy;
        
        document.getElementById('visitor-ui').innerHTML = lang === 'ko' ? `ì§€ê¸ˆê¹Œì§€ <span class="visitor-count-num" id="visit-count">...</span>ëª…ì´ ë¶„ì„ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.` : `Total <span class="visitor-count-num" id="visit-count">...</span> destinies analyzed.`;
        updateCounter();

        const ls = document.getElementById('load-seal'), lt = document.getElementById('load-title'), ld = document.getElementById('load-desc');
        if (lang === 'en') { ls.innerText = "Analyzing"; lt.innerText = "Combining Destiny Energies..."; ld.innerText = "Please wait a moment."; } 
        else { ls.innerText = "ë¶„ì„ì¤‘"; lt.innerText = "ìš´ëª…ì˜ ì—ë„ˆì§€ë¥¼ ì¡°í•© ì¤‘..."; ld.innerText = "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”."; }
        document.getElementById('seal-home').innerHTML = lang === 'ko' ? "ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤" : "Destiny<br>Lab";
        document.getElementById('seal-res').innerText = lang === 'ko' ? "ì •ì‹ë¶„ì„ë³¸" : "OFFICIAL";
        if (session.name) { processData(session.name, session.birth); }
    }

    function startAnalysis() {
        const n = document.getElementById('userName').value.trim();
        const b = document.getElementById('userBirth').value.trim();
        if(!n || b.length !== 8) { alert(currentLang === 'ko' ? "ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”." : "Check inputs."); return; }
        document.getElementById('loading-overlay').style.display = 'flex';
        setTimeout(() => { document.getElementById('loading-overlay').style.display = 'none'; processData(n, b); }, 3000);
    }

    function processData(name, birth) {
        const cleanName = name.replace(/<[^>]*>?/gm, '');
        const cleanBirth = birth.replace(/[^0-9]/g, '');
        session.name = cleanName; session.birth = cleanBirth;
        session.seed = cleanName.split('').reduce((a,b)=>a+b.charCodeAt(0),0) + parseInt(cleanBirth);
        
        let scores = [40, 40, 40, 40, 40]; 
        for(let i=0; i<cleanName.length; i++) {
            let el = /[a-zA-Z]/.test(cleanName[i]) ? alphabetElements[cleanName[i].toUpperCase()] : hangulElements[getHangulOnset(cleanName[i])];
            if(el) scores[["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"].indexOf(el)] += 35;
        }
        const month = parseInt(cleanBirth.substring(4, 6));
        scores[[11,12,1,2,3,4,5,6,7,8,9,10].indexOf(month) % 5] += 25;
        session.scores = scores.map((s, i) => s + ((session.seed + i) % 15));

        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
        const strongEl = elements[maxIdx];
        const lv = getLevel(session.scores[maxIdx]);

        document.getElementById('dynamic-title').innerText = currentLang === 'ko' ? `[${cleanName}]ë‹˜ì˜ ìš´ëª… ê³µí•™ ë¦¬í¬íŠ¸` : `Destiny Report for [${cleanName}]`;
        document.getElementById('dynamic-summary').innerText = currentLang === 'ko' ? nicknamesKo[strongEl][lv] : nicknamesEn[strongEl][lv];

        const res = nameNumerology[(session.seed % 25) + 1] || nameNumerology[1];
        session.nameReport = currentLang === 'ko' ? `ì„±ëª…í•™ì ìœ¼ë¡œ <b>${res.title}</b>ì´ë©°, ${res.desc}` : `Numerologically, you hold <b>${res.titleEn}</b>: ${res.descEn}`;

        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-result').classList.remove('hidden');
        renderChart();
        switchTab('fortune', document.getElementById('tab1'));
    }

    function getHangulOnset(char) {
        const c = char.charCodeAt(0) - 44032;
        if (c < 0 || c > 11171) return null;
        return ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'][Math.floor(c / 588)];
    }

    function renderChart() {
        const labels = currentLang === 'ko' ? ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"] : ["Wood", "Fire", "Earth", "Metal", "Water"];
        const cx = 110, cy = 110, r = 75;
        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const themeColor = elementColors[["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"][maxIdx]];
        let poly = ""; labels.forEach(() => poly += `${cx},${cy} `);
        document.getElementById('radarChart').innerHTML = `
            <svg viewBox="0 0 220 220" style="overflow:visible;">
                <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="#EEE" stroke-width="1"/>
                ${labels.map((l, i) => {
                    const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
                    const tx = cx + (r + 25) * Math.cos(a), ty = cy + (r + 25) * Math.sin(a);
                    return `<text x="${tx}" y="${ty}" text-anchor="middle" dominant-baseline="middle" fill="${currentLang === 'ko' ? '#243447' : '#999'}" font-size="12" font-weight="700">${l}</text>`;
                }).join('')}
                <polygon points="${poly}" fill="${themeColor.fill}" stroke="${themeColor.stroke}" stroke-width="2.5">
                    <animate attributeName="points" dur="1s" fill="freeze" to="${getTargetPoints(labels, cx, cy, r)}" />
                </polygon>
            </svg>`;
    }

    function getTargetPoints(labels, cx, cy, r) {
        let p = "";
        labels.forEach((_, i) => {
            const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
            const v = (session.scores[i] / 150) * r;
            p += `${cx + v * Math.cos(a)},${cy + v * Math.sin(a)} `;
        });
        return p.trim();
    }

    function switchTab(mode, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active');
        const body = document.getElementById('tab-body'); const s = session.seed;
        const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
        const t = i18n[currentLang];
        const presSource = currentLang === 'ko' ? elementPrescriptions : enPrescriptions;
        const attrSource = currentLang === 'ko' ? elementAttributesKo : elementAttributesEn;
        
        if(mode === 'fortune') {
            const maxIdx = session.scores.indexOf(Math.max(...session.scores));
            const minIdx = session.scores.indexOf(Math.min(...session.scores));
            const strongEl = elements[maxIdx]; const lackEl = elements[minIdx];
            body.innerHTML = `
                <div class="section-wrap"><span class="section-title">${t.sec1}</span><div class="info-box">${session.nameReport}</div></div>
                <div class="section-wrap"><span class="section-title">${t.sec2} [${attrSource[strongEl].name}]</span><div>â€¢ <b>${currentLang === 'ko' ? 'ì„±í–¥' : 'Trait'}:</b> ${attrSource[strongEl].trait}</div><div class="detail-item">â€¢ <b>${t.advise}:</b> ${presSource[strongEl][getLevel(session.scores[maxIdx])]}</div></div>
                <div class="section-wrap"><span class="section-title">${t.sec3} [${attrSource[lackEl].name}]</span><div>â€¢ <b>${t.practice}:</b> ${presSource[lackEl][getLevel(session.scores[minIdx])]}</div></div>
            `;
        } else if(mode === 'past') {
            const p = currentLang === 'ko' ? pastLifeData[s % pastLifeData.length] : pastLifeDataEn[s % pastLifeDataEn.length];
            body.innerHTML = `<span class="section-title">${t.tab2}</span><div class="info-box"><b>ğŸ“œ ${t.pastJob}:</b> [${p.job}]<br><br>${p.desc}<br><br><b>âœ¨ ${t.pastHomework}:</b><br>${p.homework}</div>`;
        } else {
            const r = currentLang === 'ko' ? reincarnationData[s % reincarnationData.length] : reincarnationDataEn[s % reincarnationDataEn.length];
            body.innerHTML = `<span class="section-title">${t.tab3}</span><div class="info-box"><b>ğŸ“ ${t.nextDest}:</b> ${r.place}<br><b>ğŸ§¬ ${t.nextObj}:</b> ${r.object}<br><br><b>âœ… ${t.nextMission}:</b><br>${r.mission}</div>`;
        }
    }

    function copyLink() {
        const url = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(session.name)}&birth=${session.birth}&lang=${currentLang}`;
        const t = document.createElement("textarea"); document.body.appendChild(t); t.value = `[Destiny Report] ${session.name}\n${url}`; t.select(); document.execCommand("copy"); document.body.removeChild(t);
        alert(currentLang === 'ko' ? "ë³µì‚¬ ì™„ë£Œ!" : "Link Copied!");
    }

    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('lang')) setLang(urlParams.get('lang'));
        const n = urlParams.get('name'), b = urlParams.get('birth');
        if (n && b && b.length === 8) processData(n, b);
        updateCounter();
    };
</script>
</body>
</html>
