<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destiny Lab</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://t1.daumcdn.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data: https://api.countapi.xyz; frame-src https://t1.daumcdn.net https://display.adfit.kakao.com; connect-src https://api.countapi.xyz;">
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        :root { --bg: #F0EDE9; --paper: #FFFFFF; --primary: #243447; --accent: #9A8467; --text: #444444; --border: #D1CDC5; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; overflow-x: hidden; position: relative; }
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; background-image: radial-gradient(circle at center, rgba(255, 255, 255, 0.9) 0.5px, transparent 1.2px), radial-gradient(circle at center, rgba(154, 132, 103, 0.4) 1px, transparent 2px); background-size: 50px 50px, 100px 100px; background-position: 0 0, 30px 30px; opacity: 0.4; animation: twinkle 5s ease-in-out infinite alternate; }
        @keyframes twinkle { 0% { opacity: 0.2; transform: translateY(0); } 100% { opacity: 0.6; transform: translateY(-8px); } }
        .container { width: 100%; max-width: 480px; position: relative; z-index: 1; }
        .lang-toggle { position: absolute; top: -50px; right: 0; display: flex; gap: 15px; }
        .flag { font-size: 1.6rem; cursor: pointer; opacity: 0.4; filter: grayscale(100%); transition: 0.3s; }
        .flag.active { opacity: 1; filter: grayscale(0%); transform: scale(1.2); }
        .report-card { background: var(--paper); padding: 55px 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); border: 1px solid var(--border); text-align: center; position: relative; animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .official-seal { position: absolute; top: 25px; right: 25px; width: 65px; height: 65px; border: 2px double var(--accent); color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Gowun Batang', serif; font-size: 0.7rem; font-weight: 700; opacity: 0.5; transform: rotate(12deg); pointer-events: none; }
        h1 { font-family: 'Gowun Batang', serif; font-size: 1.4rem; color: var(--primary); margin: 0 0 10px 0; word-break: keep-all; }
        .summary-line { font-family: 'Gowun Batang', serif; font-size: 0.95rem; color: var(--accent); margin-bottom: 30px; font-weight: 600; line-height: 1.4; }
        .tab-content { text-align: left; line-height: 1.9; font-size: 0.95rem; }
        .section-wrap { margin-bottom: 35px; }
        .section-title { font-family: 'Gowun Batang', serif; font-size: 1.05rem; color: var(--accent); display: block; margin-bottom: 15px; font-weight: 700; border-bottom: 1px solid #F0F0F0; padding-bottom: 8px; }
        .info-box { background: #F9F8F6; padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 15px; }
        .warning-box { background: #FFF5F5; padding: 18px; border-radius: 8px; font-size: 0.85rem; color: #C0392B; border: 1px dashed #FADBD8; margin-top: 25px; }
        .tabs { display: flex; border-bottom: 1px solid #EEE; margin: 30px 0; }
        .tab-btn { flex: 1; padding: 12px 0; border: none; background: none; cursor: pointer; font-size: 0.85rem; color: #BBB; font-family: 'Gowun Batang'; }
        .tab-btn.active { color: var(--primary); font-weight: 700; border-bottom: 2px solid var(--primary); }
        .btn-action { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 1rem; }
        .hidden { display: none; }
        input { width: 100%; padding: 15px; margin-bottom: 20px; border: none; border-bottom: 1px solid #DDD; font-size: 1.1rem; outline: none; background: transparent; }
        .visitor-counter { margin-top: 25px; font-size: 0.75rem; color: #AAA; font-family: 'Gowun Batang'; border-top: 1px solid #F5F5F5; padding-top: 15px; }
        .visitor-count-num { color: var(--accent); font-weight: 700; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

<div id="loading-overlay" style="position:fixed; inset:0; width:100%; height:100dvh; background:rgba(240, 237, 233, 0.96); z-index:9999; display:none; align-items:center; justify-content:center; padding:20px; backdrop-filter: blur(2px);">
    <div style="background:white; padding:40px 15px; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.05); border:1px solid #D1CDC5; width:100%; max-width:340px; min-width:320px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-sizing:border-box;">
        <div id="load-seal" class="official-seal" style="position:static; margin-bottom:20px; opacity:1;">ë¶„ì„ì¤‘</div>
        <h2 id="load-title" style="font-family:'Gowun Batang'; color:var(--primary); font-size:1.1rem; margin-bottom:8px; width:100%; text-align:center;">ìš´ëª…ì˜ ì—ë„ˆì§€ë¥¼ ì¡°í•© ì¤‘...</h2>
        <p id="load-desc" style="color:#888; font-size:0.8rem; margin-bottom:25px; width:100%; text-align:center;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
        <div style="width:300px; height:250px; background:#f9f9f9; display:flex; align-items:center; justify-content:center; border-radius:8px; overflow:hidden; flex-shrink:0;">
            <ins class="kakao_ad_area" style="display:none;" data-ad-unit="DAN-pMoVBneQCSicnBZ7" data-ad-width="300" data-ad-height="250"></ins>
            <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        </div>
        <div style="margin-top:25px; border:3px solid #f3f3f3; border-top:3px solid var(--accent); border-radius:50%; width:24px; height:24px; animation:spin 1s linear infinite;"></div>
    </div>
</div>

<div class="container">
    <div class="lang-toggle">
        <span class="flag active" id="flag-ko" onclick="setLang('ko')">ğŸ‡°ğŸ‡·</span>
        <span class="flag" id="flag-en" onclick="setLang('en')">ğŸ‡ºğŸ‡¸</span>
    </div>

    <div class="report-card" id="view-home">
        <div class="official-seal" id="seal-home">ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤</div>
        <h1 id="ui-title">ì„±ëª…í•™ ë°ì´í„° ë¶„ì„</h1>
        <p id="ui-desc" style="font-size:0.85rem; color:#888; margin-bottom:40px; line-height:1.6; word-break:keep-all; padding:0 10px;">ì´ë¦„ì˜ íŒŒë™ ì—ë„ˆì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ì£¼ì˜ ê³„ì ˆì  ìš”ì¸ì„ ê²°í•©í•˜ì—¬ ê³ ìœ í•œ ìš´ëª… ê¸°ìš´ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>
        <input type="text" id="userName" placeholder="ì„±í•¨">
        <input type="text" id="userBirth" placeholder="ì–‘ë ¥ ìƒë…„ì›”ì¼ 8ìë¦¬ (1000-2150)" onkeyup="if(event.key==='Enter'){startAnalysis()}">
        <button class="btn-action" id="ui-btn" onclick="startAnalysis()">ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°</button>
        <div class="visitor-counter" id="visitor-ui">ì§€ê¸ˆê¹Œì§€ <span class="visitor-count-num" id="visit-count">...</span>ëª…ì´ ë¶„ì„ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.</div>
        <div style="margin-top: 30px; display: flex; justify-content: center;">
            <ins class="kakao_ad_area" style="display:none;" data-ad-unit="DAN-gySJpKsnNTQ1FIIF" data-ad-width="320" data-ad-height="50"></ins>
            <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        </div> 
    </div>

    <div class="report-card hidden" id="view-result">
        <div class="official-seal" id="seal-res">ì •ì‹ë¶„ì„ë³¸</div>
        <h1 id="dynamic-title">ë‹˜ì„ ìœ„í•œ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
        <div id="radarChart" style="margin:0 auto 20px; width:220px; height:220px;"></div>
        <div class="summary-line" id="dynamic-summary" style="margin-top: 10px;">ë¶„ì„ ì¤‘...</div>
        <div class="tabs">
            <button class="tab-btn active" id="tab1" onclick="switchTab('fortune', this)">í˜„ìƒ ë¶„ì„</button>
            <button class="tab-btn" id="tab2" onclick="switchTab('past', this)">ì „ìƒ ê¸°ë¡</button>
            <button class="tab-btn" id="tab3" onclick="switchTab('next', this)">ë‚´ì„¸ ì˜ˆì•½</button>
        </div>
        <div class="tab-content" id="tab-body"></div>
        <button class="btn-action" style="margin-top:30px; background:white; border:1px solid #DDD; color:#444;" id="ui-copy" onclick="copyLink()">ë§í¬ ë³µì‚¬</button>
        <p onclick="window.location.href=window.location.pathname" style="font-size:0.7rem; color:#CCC; margin-top:20px; cursor:pointer;" id="ui-reset">ì´ˆê¸°í™”</p>
    </div>
</div>

<script>
    /* -------------------------------------------------------------------
       1. í•„ìˆ˜ ë°ì´í„°ì…‹
    ------------------------------------------------------------------- */
    const hangulElements = {'ã„±':'æœ¨','ã„²':'æœ¨','ã…‹':'æœ¨','ã„´':'ç«','ã„·':'ç«','ã„¸':'ç«','ã„¹':'ç«','ã…Œ':'ç«','ã…‡':'åœŸ','ã…':'åœŸ','ã……':'é‡‘','ã…†':'é‡‘','ã…ˆ':'é‡‘','ã…‰':'é‡‘','ã…Š':'é‡‘','ã…':'æ°´','ã…‚':'æ°´','ã…ƒ':'æ°´','ã…':'æ°´'};
    const alphabetElements = {'A':'æœ¨','E':'æœ¨','I':'æœ¨','O':'æœ¨','U':'æœ¨','Y':'æœ¨','B':'æ°´','P':'æ°´','M':'æ°´','F':'æ°´','W':'æ°´','C':'ç«','G':'ç«','J':'ç«','L':'ç«','S':'ç«','D':'åœŸ','N':'åœŸ','T':'åœŸ','H':'åœŸ','K':'é‡‘','R':'é‡‘','V':'é‡‘','X':'é‡‘','Q':'é‡‘','Z':'é‡‘'};
    const elementColors = { "æœ¨": { fill: "rgba(46, 204, 113, 0.3)", stroke: "#27ae60" }, "ç«": { fill: "rgba(231, 76, 60, 0.3)", stroke: "#c0392b" }, "åœŸ": { fill: "rgba(241, 196, 15, 0.3)", stroke: "#f39c12" }, "é‡‘": { fill: "rgba(149, 165, 166, 0.3)", stroke: "#7f8c8d" }, "æ°´": { fill: "rgba(52, 152, 219, 0.3)", stroke: "#2980b9" } };
    
    const i18n = {
        ko: { title: "ì„±ëª…í•™ ë°ì´í„° ë¶„ì„", desc: "ì´ë¦„ì˜ íŒŒë™ ì—ë„ˆì§€ì™€ ì‚¬ì£¼ì˜ ê³„ì ˆì  ìš”ì¸ì„ ê²°í•©í•˜ì—¬ ê³ ìœ í•œ ìš´ëª… ê¸°ìš´ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.", nameLabel: "ì„±í•¨", birthLabel: "ì–‘ë ¥ ìƒë…„ì›”ì¼ (1000-2150)", btn: "ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°", reset: "ì´ˆê¸°í™”", tab1: "í˜„ìƒ ë¶„ì„", tab2: "ì „ìƒ ê¸°ë¡", tab3: "ë‚´ì„¸ ì˜ˆì•½", copy: "ë§í¬ ë³µì‚¬", sec1: "[ì„±ëª…í•™ì  ë¶„ì„]", sec2: "[ê°•ì  ì˜¤í–‰ì˜ ê¸°ìš´]", sec3: "[ì—ë„ˆì§€ ë³´ì™„ ì²˜ë°©]", advise: "ìš´ëª…ì  ì¡°ì–¸", practice: "ì‹¤ì²œ í–‰ë²•", sideEffect: "ê³¼ìœ ë¶ˆê¸‰ ë¶€ì‘ìš©", pastJob: "ì „ìƒì˜ ì§ì—…", pastHomework: "í˜„ìƒì˜ ìˆ™ì œ", nextDest: "í™˜ìƒ ì¥ì†Œ", nextObj: "í™˜ìƒ í˜•íƒœ", nextMission: "ë¶€ì—¬ëœ ì†Œëª…" },
        en: { title: "Destiny Analysis", desc: "Extracts unique energy by combining name vibrations with seasonal factors.", nameLabel: "Full Name", birthLabel: "Birthdate (1000-2150)", btn: "Generate Report", reset: "Reset", tab1: "Present", tab2: "Past Life", tab3: "Future", copy: "Copy Link", sec1: "[Numerology]", sec2: "[Dominant Energy]", sec3: "[Remedy]", advise: "Advice", practice: "Action", sideEffect: "Side Effects", pastJob: "Past Identity", pastHomework: "Karmic Task", nextDest: "Destination", nextObj: "Born As", nextMission: "Mission" }
    };

    const elementPrescriptions = { "æœ¨": { veryStrong: "ê¸°ìš´ì´ ê³¼í•´ ë…ë‹¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", strong: "ì¶”ì§„ë ¥ì´ ì¢‹ìŠµë‹ˆë‹¤.", normal: "ì•ˆì •ì ì…ë‹ˆë‹¤.", weak: "ì˜ìš• ë³´ì¶©ì´ í•„ìš”í•©ë‹ˆë‹¤.", veryWeak: "ìƒê¸°ê°€ ê³ ê°ˆëœ ìƒíƒœì…ë‹ˆë‹¤." }, "ç«": { veryStrong: "ë²ˆì•„ì›ƒì„ ì£¼ì˜í•˜ì„¸ìš”.", strong: "ì—´ì •ì´ ë„˜ì¹©ë‹ˆë‹¤.", normal: "ì¡°í™”ë¡­ìŠµë‹ˆë‹¤.", weak: "ì˜ìš•ì´ ì €í•˜ë˜ì—ˆìŠµë‹ˆë‹¤.", veryWeak: "ë¬´ê¸°ë ¥í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤." }, "åœŸ": { veryStrong: "ìƒê°ì´ ì •ì²´ë˜ê¸° ì‰½ìŠµë‹ˆë‹¤.", strong: "í¬ìš©ë ¥ì´ í›Œë¥­í•©ë‹ˆë‹¤.", normal: "ì•ˆì •ê°ì´ ë‹ë³´ì…ë‹ˆë‹¤.", weak: "ê¸°ë°˜ì´ í”ë“¤ë¦½ë‹ˆë‹¤.", veryWeak: "ìì‹ ê°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤." }, "é‡‘": { veryStrong: "íŒë‹¨ì´ ë‚ ì¹´ë¡œì›Œ ì£¼ë³€ì„ ë‹¤ì¹˜ê²Œ í•©ë‹ˆë‹¤.", strong: "ê²°ë‹¨ë ¥ì´ ë‚ ì¹´ë¡­ìŠµë‹ˆë‹¤.", normal: "ì´ì„±ì ì…ë‹ˆë‹¤.", weak: "ìš°ìœ ë¶€ë‹¨í•´ì§€ê¸° ì‰½ìŠµë‹ˆë‹¤.", veryWeak: "ê²½ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤." }, "æ°´": { veryStrong: "ìš°ìš¸ê°ì— ë¹ ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", strong: "ì§€í˜œê°€ ìƒ˜ì†ŸìŠµë‹ˆë‹¤.", normal: "ìœ ì—°í•©ë‹ˆë‹¤.", weak: "ìœµí†µì„±ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.", veryWeak: "ì—ë„ˆì§€ê°€ ê³ ê°ˆë˜ì—ˆìŠµë‹ˆë‹¤." } };
    const nicknamesKo = { "æœ¨": { veryStrong: "ìˆ²ì„ ì‚¼í‚¤ëŠ” ê°œì²™ì", strong: "ìœ„ëŒ€í•œ ê¸°íšì", normal: "ë„˜ì¹˜ëŠ” ì¤‘ì¬ì", weak: "ì–´ë¦° ì‹¹", veryWeak: "ë‚˜ë­‡ê°€ì§€" }, "ç«": { veryStrong: "íƒœì–‘ì˜ í™”ì‹ ", strong: "ì—´ì • ë¦¬ë”", normal: "ë“±ë¶ˆ ìˆ˜í˜¸ì", weak: "ì‘ì€ ë³„ë¹›", veryWeak: "ì¬ ì†ì˜ ì˜¨ê¸°" }, "åœŸ": { veryStrong: "ê±°ëŒ€í•œ ë°”ìœ„ì‚°", strong: "ëŒ€ì§€ì˜ ìˆ˜í˜¸ì", normal: "ë“¤íŒ ê´€ë¦¬ì", weak: "ëª¨ë˜ ì–¸ë•", veryWeak: "ë¨¼ì§€ ì†ì˜ ì •ë ¹" }, "é‡‘": { veryStrong: "ì ˆëŒ€ ì‹¬íŒì", strong: "ì‹ ë…ì˜ ê²€ê°", normal: "ì§€ì„±ì˜ ì¡°ê°ê°€", weak: "í™©ê¸ˆ ì„¸ê³µì‚¬", veryWeak: "ë¬´ëª…ì˜ ì² í•™ì" }, "æ°´": { veryStrong: "ì‹¬ì—°ì˜ ì†Œìš©ëŒì´", strong: "ì§€í˜œë¡œìš´ í•­í•´ì‚¬", normal: "ê³„ê³¡ì˜ ì‹œëƒ‡ë¬¼", weak: "ê°ì„± ì˜ˆìˆ ê°€", veryWeak: "ê³ ìš”í•œ ì—°ëª»" } };
    const nicknamesEn = { "æœ¨": { veryStrong: "Unstoppable Pioneer", strong: "Grand Architect", normal: "Mediator", weak: "Dreaming Sprout", veryWeak: "Lonely Branch" }, "ç«": { veryStrong: "Explosive Sun", strong: "Solar Leader", normal: "Warm Guardian", weak: "Subtle Starlight", veryWeak: "Hidden Ember" }, "åœŸ": { veryStrong: "Immovable Mountain", strong: "Golden Guardian", normal: "Peaceful Manager", weak: "Soft Dune", veryWeak: "Spirit of Dust" }, "é‡‘": { veryStrong: "Absolute Judge", strong: "Knight of Integrity", normal: "Refined Sculptor", weak: "Flexible Goldsmith", veryWeak: "Humble Philosopher" }, "æ°´": { veryStrong: "Great Vortex", strong: "Wise Navigator", normal: "Clear Stream", weak: "Sensitive Artist", veryWeak: "Silent Pond" } };

    const pastLifeData = [ { job: "ì¡°ì„ ì‹œëŒ€ ë³´ë¶€ìƒ", desc: "íŒ”ë„ë¥¼ ëˆ„ë¹„ë©° ì†Œì‹ì„ ì „í•˜ë˜ ì •ë³´ê¾¼ì´ì—ˆìŠµë‹ˆë‹¤.", homework: "ì§„ì‹¤ëœ ì†Œí†µìœ¼ë¡œ ì‹ ë¢°ë¥¼ ìŒ“ìœ¼ì„¸ìš”." }, { job: "ë¶ìœ ëŸ½ ë°”ì´í‚¹", desc: "ê±°ì¹œ ë°”ë‹¤ë¥¼ í•­í•´í•˜ë©° ìš©ê¸°ë¥¼ ì¦ëª…í•˜ë˜ ì „ì‚¬ì˜€ìŠµë‹ˆë‹¤.", homework: "í˜„ìƒì€ ë¬´ë ¥ì´ ì•„ë‹Œ ì§€í˜œë¡œ ìŠ¹ë¶€í•˜ì„¸ìš”." }, { job: "ì´ì§‘íŠ¸ ì„œê¸°", desc: "ì§€ì‹ì„ ê¸°ë¡í•˜ê³  ìˆ˜í˜¸í•˜ë˜ í•™ìì˜€ìŠµë‹ˆë‹¤.", homework: "ë°°ìš´ ì§€ì‹ì„ ì„¸ìƒê³¼ ë‚˜ëˆ„ëŠ” ì‚¶ì„ ì‚¬ì„¸ìš”." }, { job: "ë¥´ë„¤ìƒìŠ¤ í™”ê³µ", desc: "ì„¸ìƒì˜ ì•„ë¦„ë‹¤ì›€ì„ ìº”ë²„ìŠ¤ì— ë‹´ë˜ ì˜ˆìˆ ê°€ì˜€ìŠµë‹ˆë‹¤.", homework: "ë‚´ë©´ì˜ ì•„ë¦„ë‹¤ì›€ì„ ë°œê²¬í•˜ëŠ” ëˆˆì„ ê¸°ë¥´ì„¸ìš”." }, { job: "ì¸ë””ì–¸ ì¶”ì¥", desc: "ìì—°ì˜ íë¦„ì„ ì½ê³  ë¶€ì¡±ì„ ì´ëŒë˜ ë¦¬ë”ì˜€ìŠµë‹ˆë‹¤.", homework: "ê³µë™ì²´ë¥¼ ì±…ì„ì§€ëŠ” ë§ˆìŒì„ ë°°ìš°ì‹­ì‹œì˜¤." }, { job: "ì‹¤í¬ë¡œë“œ ëŒ€ìƒ", desc: "ë™ì„œë¥¼ ì‡ëŠ” ê¸¸ ìœ„ì—ì„œ ì¸ë‚´ë¥¼ ë°°ì› ë˜ ìˆ˜í–‰ìì˜€ìŠµë‹ˆë‹¤.", homework: "ëŠë¦¬ë”ë¼ë„ ëê¹Œì§€ ë‚˜ì•„ê°€ëŠ” í˜ì„ ê¸°ë¥´ì„¸ìš”." }, { job: "ê³ êµ¬ë ¤ ë¬´ì‚¬", desc: "êµ­ê²½ì„ ì§€í‚¤ë©° ëŒ€ë¥™ì„ í˜¸ë ¹í•˜ë˜ ìš©ë§¹í•œ êµ°ì¸ì´ì—ˆìŠµë‹ˆë‹¤.", homework: "ê°•í•œ í˜ì„ íƒ€ì¸ì„ ë³´í˜¸í•˜ëŠ” ë° ì‚¬ìš©í•˜ì„¸ìš”." }, { job: "ì¤‘ì„¸ ì•½ì´ˆì‚¬", desc: "ìˆ²ì†ì—ì„œ ìƒëª…ì„ ì‚´ë¦¬ëŠ” ë¹„ë°©ì„ ì—°êµ¬í•˜ë˜ ì¹˜ìœ ìì˜€ìŠµë‹ˆë‹¤.", homework: "ì‚¬ëŒë“¤ì˜ ë§ˆìŒì„ ì–´ë£¨ë§Œì§€ëŠ” ëŠ¥ë ¥ì„ ë°œíœ˜í•˜ì„¸ìš”." }, { job: "ë¬´ëª… ì†Œë¦¬ê¾¼", desc: "í•œ ì„œë¦° ëª©ì†Œë¦¬ë¡œ ë¯¼ì´ˆë“¤ì˜ ìŠ¬í””ì„ ë‹¬ë˜ì£¼ë˜ ê´‘ëŒ€ì˜€ìŠµë‹ˆë‹¤.", homework: "ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ë¡œ ì„¸ìƒì— ê¸°ì¨ì„ ì „í•˜ì„¸ìš”." }, { job: "ë¡œë§ˆ ì›ë¡œì›", desc: "ì§ˆì„œì™€ ë²•ì„ ë…¼í•˜ë©° ì œêµ­ì„ ì„¤ê³„í•˜ë˜ ì •ì¹˜ê°€ì˜€ìŠµë‹ˆë‹¤.", homework: "ê³µì •í•œ íƒœë„ë¡œ ê· í˜• ìˆëŠ” ì‚¶ì„ ê¾¸ë ¤ê°€ì„¸ìš”." } ];
    const reincarnationData = [ { place: "ì•„í‹€ë€í‹°ìŠ¤", object: "í•´ì–‘ ì—°êµ¬ê°€", mission: "ë°”ë‹¤ì˜ ë¹„ë°€ì„ í’€ì–´ ì¸ë¥˜ë¥¼ êµ¬ì›í•˜ì„¸ìš”." }, { place: "í™”ì„± ì—ë´", object: "ìƒíƒœ ê±´ì¶•ê°€", mission: "ì²™ë°•í•œ ë•…ì— í‘¸ë¥¸ ìƒëª…ì„ ì‹¬ìœ¼ì„¸ìš”." }, { place: "ë„¤ì˜¤ ë„ì¿„", object: "ê¸°ì–µ ìˆ˜ì‚¬ê´€", mission: "ì§„ì‹¤ì„ ì°¾ì•„ ì •ì˜ë¥¼ êµ¬í˜„í•˜ì‹­ì‹œì˜¤." }, { place: "ì²œê³µì˜ ì„¬", object: "ë°”ëŒì˜ ì¡°ìœ¨ì‚¬", mission: "ê¸°í›„ì˜ í‰í™”ë¥¼ ìœ ì§€í•˜ëŠ” ì†Œëª…ì„ ë‹¤í•˜ì„¸ìš”." }, { place: "í‰í–‰ ìš°ì£¼", object: "ë°ì´í„° ì†Œìš¸", mission: "ìˆœìˆ˜í•œ ì§€ì„±ì„ ê½ƒí”¼ìš°ëŠ” ì¡´ì¬ê°€ ë˜ì‹­ì‹œì˜¤." }, { place: "ë¯¸ë˜ì˜ ë‹¬ ê¸°ì§€", object: "ìš°ì£¼ í•­í•´ì‚¬", mission: "ìƒˆë¡œìš´ í–‰ì„±ì„ ë°œê²¬í•˜ì—¬ ì˜í† ë¥¼ ë„“íˆì„¸ìš”." }, { place: "ì•ˆë“œë¡œë©”ë‹¤", object: "ì°¨ì› ì—¬í–‰ì", mission: "ì—¬ëŸ¬ ì°¨ì›ì˜ í‰í™”ë¥¼ ì‡ëŠ” ê°€êµê°€ ë˜ì„¸ìš”." }, { place: "ì§€ì € ë„ì‹œ", object: "ë¹›ì˜ ì±„êµ´ê¾¼", mission: "ì–´ë‘  ì†ì—ì„œ ìƒˆë¡œìš´ ì—ë„ˆì§€ë¥¼ ì°¾ìœ¼ì„¸ìš”." }, { place: "ì˜ì  ì•ˆì‹ì²˜", object: "ìš´ëª…ì˜ ìˆ˜í˜¸ì", mission: "ê¸¸ ìƒì€ ì˜í˜¼ë“¤ì„ ì¸ë„í•˜ëŠ” ê°€ì´ë“œê°€ ë˜ì„¸ìš”." }, { place: "ì‚¬ì´ë²„ ìŠ¤í˜ì´ìŠ¤", object: "AI ê±´ì¶•ê°€", mission: "ì¸ê°„ê³¼ ê¸°ê³„ì˜ ê³µì¡´ì„ ì„¤ê³„í•˜ì‹­ì‹œì˜¤." } ];
    const sideEffects = ["ë””ì €íŠ¸ê°€ ë¯¸ì¹˜ë„ë¡ ë¨¹ê³  ì‹¶ì–´ì§", "ì „ìƒì´ ëŒë©ì´ì˜€ìŒì„ ê¹¨ë‹«ê³  ë©í•´ì§", "ì–‘ë§ í•œ ì§ ì˜ì›íˆ ì‹¤ì¢…", "ë…¸ë˜ê°€ ë‚´ ì´ì•¼ê¸°ì²˜ëŸ¼ ë“¤ë¦¼", "ëƒ‰ì¥ê³  ì†ŒìŠ¤ ìœ í†µê¸°í•œ ì ê²€ ê°•ë°•"];
    const sideEffectsEn = ["Craving for spicy food.", "Realization that you were a rock.", "One sock disappearing forever.", "Lyrics feeling too relatable.", "Checking expiration dates obsession."];
    const quoteData = { "ì¸ìƒ": [ { text: "ëª¨ë“  ê½ƒì€ ì €ë§ˆë‹¤ì˜ ì‹œê°„ì— í•€ë‹¤." }, { text: "ì‚¶ì´ ìˆëŠ” í•œ í¬ë§ì€ ìˆë‹¤." }, { text: "ì¸ìƒì€ ì†ë„ê°€ ì•„ë‹ˆë¼ ë°©í–¥ì´ë‹¤." } ] };
    const quoteDataEn = { "life": [ { text: "Every flower blooms in its own time." }, { text: "Where there is life, there is hope." }, { text: "Life is about direction, not speed." } ] };

    /* -------------------------------------------------------------------
       2. í•µì‹¬ ë¡œì§ í•¨ìˆ˜
    ------------------------------------------------------------------- */
    let currentLang = 'ko';
    let session = { name: '', birth: '', seed: 0, scores: [], nameReport: '' };

    function getLevel(sc) {
        if (sc >= 110) return 'veryStrong';
        if (sc >= 80) return 'strong';
        if (sc >= 50) return 'normal';
        if (sc >= 20) return 'weak';
        return 'veryWeak';
    }

    async function updateCounter() {
        try {
            const res = await fetch('https://api.countapi.xyz/hit/destinylab.github.io/visits');
            const data = await res.json();
            animateValue("visit-count", 0, data.value, 2000);
        } catch (e) { document.getElementById('visit-count').innerText = "1,245"; }
    }

    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        const range = end - start;
        const startTime = new Date().getTime();
        const timer = setInterval(() => {
            const now = new Date().getTime();
            const progress = Math.min((now - startTime) / duration, 1);
            obj.innerText = Math.floor(progress * range + start).toLocaleString();
            if (progress === 1) clearInterval(timer);
        }, 30);
    }

    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
        document.getElementById(`flag-${lang}`).classList.add('active');
        const t = i18n[lang];
        document.getElementById('ui-title').innerText = t.title;
        document.getElementById('ui-desc').innerText = t.desc;
        document.getElementById('userName').placeholder = t.nameLabel;
        document.getElementById('userBirth').placeholder = t.birthLabel;
        document.getElementById('ui-btn').innerText = t.btn;
        document.getElementById('ui-reset').innerText = t.reset;
        document.getElementById('tab1').innerText = t.tab1;
        document.getElementById('tab2').innerText = t.tab2;
        document.getElementById('tab3').innerText = t.tab3;
        document.getElementById('ui-copy').innerText = t.copy;

        const ls = document.getElementById('load-seal'), lt = document.getElementById('load-title'), ld = document.getElementById('load-desc');
        if (lang === 'en') { ls.innerText = "Analyzing"; lt.innerText = "Combining Destiny Energies..."; ld.innerText = "Please wait a moment."; } 
        else { ls.innerText = "ë¶„ì„ì¤‘"; lt.innerText = "ìš´ëª…ì˜ ì—ë„ˆì§€ë¥¼ ì¡°í•© ì¤‘..."; ld.innerText = "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”."; }
        document.getElementById('seal-home').innerHTML = lang === 'ko' ? "ìš´ëª…ê³µí•™<br>ë¶„ì„ì‹¤" : "Destiny<br>Lab";
        document.getElementById('seal-res').innerText = lang === 'ko' ? "ì •ì‹ë¶„ì„ë³¸" : "OFFICIAL";
        if (session.name) { processData(session.name, session.birth); }
    }

    function getHangulOnset(char) {
        const c = char.charCodeAt(0) - 44032;
        if (c < 0 || c > 11171) return null;
        return ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'][Math.floor(c / 588)];
    }

    function startAnalysis() {
        const n = document.getElementById('userName').value.trim();
        const b = document.getElementById('userBirth').value.trim();
        if(!n || b.length !== 8) { alert(currentLang === 'ko' ? "ì„±í•¨ê³¼ ìƒë…„ì›”ì¼ 8ìë¦¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”." : "Check inputs."); return; }
        const year = parseInt(b.substring(0, 4));
        if(year < 1000 || year > 2150) { alert(currentLang === 'ko' ? "ì—°ë„ëŠ” 1000~2150ë…„ ì‚¬ì´ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤." : "Year must be 1000-2150."); return; }
        document.getElementById('loading-overlay').style.display = 'flex';
        setTimeout(() => { document.getElementById('loading-overlay').style.display = 'none'; processData(n, b); }, 3000);
    }

    function processData(name, birth) {
        const cleanName = name.replace(/<[^>]*>?/gm, '');
        const cleanBirth = birth.replace(/[^0-9]/g, '');
        session.name = cleanName; session.birth = cleanBirth;
        session.seed = cleanName.split('').reduce((a,b)=>a+b.charCodeAt(0),0) + parseInt(cleanBirth);
        
        let scores = [40, 40, 40, 40, 40]; 
        for(let i=0; i<cleanName.length; i++) {
            let el = /[a-zA-Z]/.test(cleanName[i]) ? alphabetElements[cleanName[i].toUpperCase()] : hangulElements[getHangulOnset(cleanName[i])];
            if(el) scores[["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"].indexOf(el)] += 35;
        }
        const month = parseInt(cleanBirth.substring(4, 6));
        scores[[11,12,1,2,3,4,5,6,7,8,9,10].indexOf(month) % 5] += 25;
        session.scores = scores.map((s, i) => s + ((session.seed + i) % 15));

        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const strongEl = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"][maxIdx];
        const lv = getLevel(session.scores[maxIdx]);

        document.getElementById('dynamic-title').innerText = currentLang === 'ko' ? `[${cleanName}]ë‹˜ì˜ ìš´ëª… ë¦¬í¬íŠ¸` : `Report for [${cleanName}]`;
        document.getElementById('dynamic-summary').innerText = currentLang === 'ko' ? nicknamesKo[strongEl][lv] : nicknamesEn[strongEl][lv];

        session.nameReport = currentLang === 'ko' ? "ì„±ëª…í•™ ë¶„ì„ ê²°ê³¼ í›Œë¥­í•œ ê· í˜•ì„ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤." : "You have a great balance according to numerology.";

        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-result').classList.remove('hidden');
        renderChart();
        switchTab('fortune', document.getElementById('tab1'));
    }

    function renderChart() {
        const labels = currentLang === 'ko' ? ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"] : ["Wood", "Fire", "Earth", "Metal", "Water"];
        const cx = 110, cy = 110, r = 75;
        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const themeColor = elementColors[["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"][maxIdx]];
        let poly = ""; labels.forEach(() => poly += `${cx},${cy} `);
        document.getElementById('radarChart').innerHTML = `
            <svg viewBox="0 0 220 220" style="overflow:visible;">
                <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="#EEE" stroke-width="1"/>
                ${labels.map((l, i) => {
                    const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
                    const tx = cx + (r + 25) * Math.cos(a), ty = cy + (r + 25) * Math.sin(a);
                    return `<text x="${tx}" y="${ty}" text-anchor="middle" dominant-baseline="middle" fill="#243447" font-size="12" font-weight="700">${l}</text>`;
                }).join('')}
                <polygon points="${poly}" fill="${themeColor.fill}" stroke="${themeColor.stroke}" stroke-width="2.5">
                    <animate attributeName="points" dur="1s" fill="freeze" to="${getTargetPoints(labels, cx, cy, r)}" />
                </polygon>
            </svg>`;
    }

    function getTargetPoints(labels, cx, cy, r) {
        let p = "";
        labels.forEach((_, i) => {
            const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
            const v = (session.scores[i] / 150) * r;
            p += `${cx + v * Math.cos(a)},${cy + v * Math.sin(a)} `;
        });
        return p.trim();
    }

    function switchTab(mode, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active');
        const body = document.getElementById('tab-body'); const s = session.seed;
        const t = i18n[currentLang];
        
        if(mode === 'fortune') {
            const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
            const maxIdx = session.scores.indexOf(Math.max(...session.scores));
            const minIdx = session.scores.indexOf(Math.min(...session.scores));
            const strongEl = elements[maxIdx]; const lackEl = elements[minIdx];
            
            const sideSource = currentLang === 'ko' ? sideEffects : sideEffectsEn;
            const quoteSource = currentLang === 'ko' ? quoteData["ì¸ìƒ"] : quoteDataEn["life"];

            // [ì¸ë±ìŠ¤ ê³ ì • ë¡œì§]
            const masterSideIdx = s % sideEffects.length;
            const finalSideEffect = sideSource[masterSideIdx % sideSource.length];
            const masterQuoteIdx = s % quoteData["ì¸ìƒ"].length;
            const finalQuote = quoteSource[masterQuoteIdx % quoteSource.length].text;

            body.innerHTML = `
                <div class="section-wrap"><span class="section-title">${t.sec1}</span><div class="info-box">${session.nameReport}</div></div>
                <div class="section-wrap"><span class="section-title">${t.sec2}</span><div>â€¢ <b>ê¸°ìš´:</b> ${strongEl}</div><div>â€¢ <b>${t.advise}:</b> ${elementPrescriptions[strongEl][getLevel(session.scores[maxIdx])]}</div></div>
                <div class="section-wrap"><span class="section-title">${t.sec3}</span><div>â€¢ <b>${t.practice}:</b> ${elementPrescriptions[lackEl][getLevel(session.scores[minIdx])]}</div></div>
                <div class="warning-box"><b>âš ï¸ ${t.sideEffect}</b><br>${finalSideEffect}</div>
                <div style="margin-top:30px; text-align:center; color:#AAA; font-style:italic;">"${finalQuote}"</div>
            `;
        } else if(mode === 'past') {
            const p = pastLifeData[s % pastLifeData.length];
            body.innerHTML = `<span class="section-title">${t.tab2}</span><div class="info-box"><b>ğŸ“œ ${t.pastJob}:</b> [${p.job}]<br><br>${p.desc}<br><br><b>âœ¨ ${t.pastHomework}:</b><br>${p.homework}</div>`;
        } else {
            const r = reincarnationData[s % reincarnationData.length];
            body.innerHTML = `<span class="section-title">${t.tab3}</span><div class="info-box"><b>ğŸ“ ${t.nextDest}:</b> ${r.place}<br><b>ğŸ§¬ ${t.nextObj}:</b> ${r.object}<br><br><b>âœ… ${t.nextMission}:</b><br>${r.mission}</div>`;
        }
    }

    function copyLink() {
        const url = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(session.name)}&birth=${session.birth}&lang=${currentLang}`;
        const t = document.createElement("textarea"); document.body.appendChild(t); t.value = `[Destiny Lab] ${session.name}\n${url}`; t.select(); document.execCommand("copy"); document.body.removeChild(t);
        alert(currentLang === 'ko' ? "ë³µì‚¬ ì™„ë£Œ!" : "Link Copied!");
    }

    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('lang')) setLang(urlParams.get('lang'));
        const n = urlParams.get('name'), b = urlParams.get('birth');
        if (n && b && b.length === 8) processData(n, b);
        updateCounter();
    };
</script>
</body>
</html>
