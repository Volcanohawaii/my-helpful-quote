<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš´ëª… ê³µí•™ ë¶„ì„ì†Œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        :root { --bg: #F0EDE9; --paper: #FFFFFF; --primary: #243447; --accent: #9A8467; --text: #444444; --border: #D1CDC5; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .container { width: 100%; max-width: 480px; position: relative; }
        .report-card { background: var(--paper); padding: 55px 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); border: 1px solid var(--border); text-align: center; animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        h1 { font-family: 'Gowun Batang', serif; font-size: 1.7rem; color: var(--primary); margin: 0 0 10px 0; }
        .serial-num { font-size: 0.7rem; color: #AAA; letter-spacing: 2px; margin-bottom: 40px; display: block; }

        .tab-content { text-align: left; line-height: 1.9; font-size: 0.95rem; letter-spacing: -0.2px; }
        .section-wrap { margin-bottom: 35px; }
        .section-title { font-family: 'Gowun Batang', serif; font-size: 1.05rem; color: var(--accent); display: block; margin-bottom: 15px; font-weight: 700; border-bottom: 1px solid #F0F0F0; padding-bottom: 8px; }

        .info-box { background: #F9F8F6; padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 15px; }
        .detail-item { font-size: 0.9rem; color: #666; margin-top: 8px; padding-left: 5px; }
        .warning-box { background: #FFF5F5; padding: 18px; border-radius: 8px; font-size: 0.85rem; color: #C0392B; border: 1px dashed #FADBD8; margin-top: 25px; }

        .tabs { display: flex; border-bottom: 1px solid #EEE; margin: 30px 0 30px; }
        .tab-btn { flex: 1; padding: 12px 0; border: none; background: none; cursor: pointer; font-family: 'Gowun Batang', serif; font-size: 0.9rem; color: #BBB; }
        .tab-btn.active { color: var(--primary); font-weight: 700; border-bottom: 2px solid var(--primary); }

        .quote-footer { margin-top: 40px; padding-top: 25px; border-top: 1px solid #F0F0F0; text-align: center; }
        .btn-action { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: 0.3s; }
        .btn-action:hover { background: #151f2b; }
        
        .hidden { display: none; }
        .chart-wrap { margin: 25px auto; width: 220px; height: 220px; }
        input { width: 100%; padding: 15px; margin-bottom: 20px; border: none; border-bottom: 1px solid #DDD; font-size: 1.1rem; outline: none; transition: 0.3s; }
        input:focus { border-bottom-color: var(--primary); background: #FAF9F7; }
    </style>
</head>
<body>
<div class="container">
    <div class="report-card" id="view-home">
        <h1>ì„±ëª…í•™ ë°ì´í„° ë¶„ì„</h1>
        <p style="font-size: 0.9rem; color: #888; margin-bottom: 40px;">ì„±ëª…ê³¼ ìƒë…„ì›”ì¼ì„ ë°”íƒ•ìœ¼ë¡œ ì •ì‹ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
        <div style="text-align:left;">
            <input type="text" id="userName" placeholder="ì„±í•¨">
            <input type="text" id="userBirth" placeholder="ìƒë…„ì›”ì¼ ì–‘ë ¥ (ì˜ˆ: 19940702)">
        </div>
        <button class="btn-action" onclick="startAnalysis()">ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°</button>
    </div>

    <div class="report-card hidden" id="view-result">
        <span class="serial-num" id="res-id">REF. #00000000</span>
        <h1 id="res-header">ìš´ëª… ë°ì´í„° ë¶„ì„ ê²°ê³¼</h1>
        <div class="chart-wrap" id="radarChart"></div>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('fortune', this)">í˜„ìƒ ë¶„ì„</button>
            <button class="tab-btn" onclick="switchTab('past', this)">ì „ìƒ ê¸°ë¡</button>
            <button class="tab-btn" onclick="switchTab('next', this)">ë‚´ì„¸ ì˜ˆì•½</button>
        </div>
        
        <div class="tab-content" id="tab-body"></div>
        <button class="btn-action" style="margin-top:40px; background:white; border:1px solid var(--border); color:var(--text);" onclick="copyLink()">ê²°ê³¼ ì €ì¥ ë° ë§í¬ ë³µì‚¬</button>
        
        <p onclick="window.location.href=window.location.pathname" style="font-size:0.7rem; color:#CCC; margin-top:20px; cursor:pointer; text-decoration:underline;">
            ìƒˆë¡œìš´ ìš´ëª… ë¶„ì„í•˜ê¸° (ì´ˆê¸°í™”)
        </p>
    </div>
</div>

<script src="quotes.js"></script>
<script>
    let session = { name: '', birth: '', seed: 0, scores: [], nameReport: '' };

    function startAnalysis() {
        const name = document.getElementById('userName').value.trim();
        const birth = document.getElementById('userBirth').value.trim();
        if(!name || birth.length !== 8) { alert("ì •í™•í•œ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤."); return; }
        processData(name, birth);
    }

    function processData(name, birth) {
        session.name = name; session.birth = birth;
        session.seed = name.split('').reduce((a,b)=>a+b.charCodeAt(0),0) + parseInt(birth);
        let scores = [40, 40, 40, 40, 40]; 
        for(let i=0; i<name.length; i++) {
            const onset = getHangulOnset(name[i]);
            const element = hangulElements[onset];
            if(element) {
                const idx = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"].indexOf(element);
                scores[idx] += 30; 
            }
        }
        const month = parseInt(birth.substring(4, 6));
        if([2, 3].includes(month)) scores[0] += 25;
        else if([5, 6].includes(month)) scores[1] += 25;
        else if([8, 9].includes(month)) scores[3] += 25;
        else if([11, 12].includes(month)) scores[4] += 25;
        else scores[2] += 25;
        session.scores = scores.map((s, i) => s + ((session.seed + i) % 15));
        const strokeVal = (session.seed % 25) + 1;
        const res = nameNumerology[strokeVal] || nameNumerology[1];
        session.nameReport = `ì„±ëª…í•™ì ìœ¼ë¡œ <b>${res.title}</b>ì— í•´ë‹¹í•˜ë©°, ${res.desc}`;
        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-result').classList.remove('hidden');
        document.getElementById('res-id').innerText = `ANALYSIS CASE #${session.seed}`;
        renderChart();
        switchTab('fortune', document.querySelector('.tab-btn'));
    }

    function getHangulOnset(char) {
        const charCode = char.charCodeAt(0) - 44032;
        if (charCode < 0 || charCode > 11171) return null;
        const onsets = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        return onsets[Math.floor(charCode / 588)];
    }

    function renderChart() {
        const labels = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
        const cx = 110, cy = 110, r = 80;
        let polyPoints = "";
        labels.forEach((l, i) => {
            const angle = (Math.PI * 2 / 5) * i - (Math.PI / 2);
            const value = (session.scores[i] / 150) * r;
            polyPoints += `${cx + value * Math.cos(angle)},${cy + value * Math.sin(angle)} `;
        });
        document.getElementById('radarChart').innerHTML = `
            <svg viewBox="0 0 220 220" style="overflow:visible;">
                <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="#EEE" />
                <circle cx="${cx}" cy="${cy}" r="${r*0.6}" fill="none" stroke="#EEE" />
                ${labels.map((l, i) => {
                    const a = (Math.PI * 2 / 5) * i - (Math.PI / 2);
                    return `<line x1="${cx}" y1="${cy}" x2="${cx + r * Math.cos(a)}" y2="${cx + r * Math.sin(a)}" stroke="#EEE" stroke-dasharray="2,2" />
                            <text x="${cx + (r+20) * Math.cos(a)}" y="${cx + (r+20) * Math.sin(a)}" text-anchor="middle" font-size="12" fill="#999" font-weight="600">${l}</text>`;
                }).join('')}
                <polygon points="${polyPoints}" fill="rgba(154, 132, 103, 0.3)" stroke="var(--accent)" stroke-width="2.5" />
            </svg>`;
    }

    function switchTab(mode, btn) {
        if(btn) { document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
        const body = document.getElementById('tab-body');
        const s = session.seed;
        const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
        const getLevel = (score) => { if(score >= 75) return 'strong'; if(score >= 45) return 'normal'; return 'weak'; };
        const maxIdx = session.scores.indexOf(Math.max(...session.scores));
        const minIdx = session.scores.indexOf(Math.min(...session.scores));
        if(mode === 'fortune') {
            const strongEl = elements[maxIdx];
            const lackEl = elements[minIdx];
            body.innerHTML = `
                <div class="section-wrap">
                    <span class="section-title">1. ì„±ëª… ìˆ˜ë¦¬ ë¶„ì„ ê²°ê³¼</span>
                    <div class="info-box">${session.nameReport}</div>
                </div>
                <div class="section-wrap">
                    <span class="section-title">2. ì£¼ì²´ ì—ë„ˆì§€ ë¶„ì„ [${strongEl}]</span>
                    <div><b>ê¸°ì§ˆ ì§„ë‹¨:</b> ${elementAttributes[strongEl].trait}</div>
                    <div class="detail-item">â€¢ <b>ìš´ëª… ì¡°ì–¸:</b> ${elementPrescriptions[strongEl][getLevel(session.scores[maxIdx])]}</div>
                </div>
                <div class="section-wrap">
                    <span class="section-title">3. ì—ë„ˆì§€ ë³´ê°• ì§€ì¹¨ [${lackEl}]</span>
                    <div><b>ë³´ê°• í•„ìš”:</b> í˜„ì¬ ${lackEl}ì˜ ê¸°ìš´ì´ ìƒëŒ€ì ìœ¼ë¡œ ì•½í•¨</div>
                    <div class="detail-item">â€¢ <b>ì‹¤ì²œ í–‰ë²•:</b> ${elementPrescriptions[lackEl][getLevel(session.scores[minIdx])]}</div>
                </div>
                <div class="warning-box">
                    <b>âš ï¸ ì—ë„ˆì§€ ì¡°ì • ë¶€ì‘ìš© ì£¼ì˜</b><br>
                    ${sideEffects[s % sideEffects.length]}
                </div>
                <div class="quote-footer">
                    <div style="margin-bottom:12px;">
                        <span style="background:var(--primary); color:white; padding:2px 8px; border-radius:10px; font-size:0.75rem; margin-right:5px;">ACTION</span>
                        <b>${recommendations[s % recommendations.length]}</b>
                    </div>
                    <span style="font-size:0.85rem; color:#AAA; font-style:italic;">"${quoteData["ì¸ìƒ"][s % quoteData["ì¸ìƒ"].length].text}"</span>
                </div>
            `;
        } else if(mode === 'past') {
            const p = pastLifeData[(maxIdx * 6 + s % 6) % 30];
            body.innerHTML = `<span class="section-title">ì „ê±°(å‰å±…) ì—ë„ˆì§€ ê¸°ë¡</span><div class="info-box" style="line-height:2;">ê³¼ê±° ê·€í•˜ëŠ” <b>[${p.job}]</b>ì˜ ì†Œëª…ì„ ë‹¤í–ˆìŠµë‹ˆë‹¤.<br>${p.desc}</div><div style="margin-top:20px;"><b>í˜„ìƒì˜ ìˆ™ì œ:</b><br> " ${p.homework} "</div>`;
        } else {
            const r = reincarnationData[s % 30];
            body.innerHTML = `<span class="section-title">ì°¨ê¸° ë‚´ì„¸ ì˜ˆì•½ í™•ì•½ì„œ</span><div class="info-box">ì—ë„ˆì§€ ì „ì´ ê²½ë¡œê°€ ê³µì‹ í™•ì•½ë˜ì—ˆìŠµë‹ˆë‹¤.</div><div style="line-height:2.2;">â€¢ <b>ì°¨ê¸° ì •ì°©ì§€:</b> ${r.place}<br>â€¢ <b>ì¬íƒ„ìƒ í˜•íƒœ:</b> ${r.object}<br>â€¢ <b>í™•ì • ì¡°ê±´:</b> ${r.mission}</div>`;
        }
    }

    function copyLink() {
        const url = `${window.location.origin}${window.location.pathname}?name=${encodeURIComponent(session.name)}&birth=${session.birth}`;
        const t = document.createElement("textarea"); document.body.appendChild(t); t.value = `[ìš´ëª… ê³µí•™ ë¦¬í¬íŠ¸] ${session.name}ë‹˜ì˜ ë¶„ì„ ê²°ê³¼:\n${url}`; t.select(); document.execCommand("copy"); document.body.removeChild(t);
        alert("ë‚˜ì˜ ë°ì´í„°ê°€ ë‹´ê¸´ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ");
    }

    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const n = urlParams.get('name'); const b = urlParams.get('birth');
        if (n && b && b.length === 8) { processData(n, b); }
    };
</script>
</body>
</html>
